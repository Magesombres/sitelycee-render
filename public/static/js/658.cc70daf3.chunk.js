"use strict";(self.webpackChunkclient=self.webpackChunkclient||[]).push([[658],{658:(e,r,s)=>{s.r(r),s.d(r,{default:()=>i});var t=s(555),a=s(43),o=s(674),n=s(579);const i=function(){const[e,r]=(0,a.useState)({username:"",role:""}),[s,i]=(0,a.useState)({currentPassword:"",newPassword:"",confirmNewPassword:""}),[l,u]=(0,a.useState)(""),[d,c]=(0,a.useState)(""),[m,h]=(0,a.useState)(""),p=(0,a.useMemo)(()=>"admin"===localStorage.getItem("role"),[]);(0,a.useEffect)(()=>{(async()=>{try{const{data:e}=await o.A.get("/user/me");r(e),u(e.username)}catch(t){var e,s;h((null===(e=t.response)||void 0===e||null===(s=e.data)||void 0===s?void 0:s.error)||"Erreur profil")}})()},[]);const v=(0,a.useMemo)(()=>{const e=s.newPassword||"";return e?e.length<8?"Au moins 8 caract\xe8res":/[A-Z]/.test(e)?/[a-z]/.test(e)?/[0-9]/.test(e)?/[^A-Za-z0-9]/.test(e)?"":"Au moins un caract\xe8re sp\xe9cial":"Au moins un chiffre":"Au moins une minuscule":"Au moins une majuscule":""},[s.newPassword]);return(0,n.jsxs)("div",{style:{maxWidth:520,margin:"24px auto"},children:[(0,n.jsx)("h2",{children:"Mon compte"}),m&&(0,n.jsx)("div",{style:{color:"red",marginBottom:12},children:m}),d&&(0,n.jsx)("div",{style:{color:"green",marginBottom:12},children:d}),(0,n.jsxs)("div",{style:{marginBottom:24},children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("b",{children:"Utilisateur:"})," ",e.username]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("b",{children:"R\xf4le:"})," ",e.role]})]}),(0,n.jsxs)("form",{onSubmit:async e=>{e.preventDefault(),c(""),h("");try{if(v)return h(v);const{data:e}=await o.A.patch("/user/password",s);c(e.message||"Mot de passe mis \xe0 jour"),i({currentPassword:"",newPassword:"",confirmNewPassword:""})}catch(a){var r,t;h((null===(r=a.response)||void 0===r||null===(t=r.data)||void 0===t?void 0:t.error)||"Erreur mise \xe0 jour mot de passe")}},style:{marginBottom:32},children:[(0,n.jsx)("h3",{children:"Changer le mot de passe"}),(0,n.jsx)("input",{type:"password",placeholder:"Mot de passe actuel",value:s.currentPassword,onChange:e=>i(r=>(0,t.A)((0,t.A)({},r),{},{currentPassword:e.target.value})),required:!0,style:{display:"block",marginBottom:8,width:"100%"}}),(0,n.jsx)("input",{type:"password",placeholder:"Nouveau mot de passe",value:s.newPassword,onChange:e=>i(r=>(0,t.A)((0,t.A)({},r),{},{newPassword:e.target.value})),required:!0,style:{display:"block",marginBottom:8,width:"100%"}}),(0,n.jsx)("input",{type:"password",placeholder:"Confirmez le mot de passe",value:s.confirmNewPassword,onChange:e=>i(r=>(0,t.A)((0,t.A)({},r),{},{confirmNewPassword:e.target.value})),required:!0,style:{display:"block",marginBottom:8,width:"100%"}}),!m&&v&&(0,n.jsx)("div",{style:{color:"#a66",marginBottom:8},children:v}),(0,n.jsx)("button",{type:"submit",disabled:!!v,children:"Mettre \xe0 jour le mot de passe"})]}),p&&(0,n.jsxs)("form",{onSubmit:async e=>{e.preventDefault(),c(""),h("");try{const{data:e}=await o.A.patch("/user/username",{username:l.trim()});var s;if(e.token)localStorage.setItem("token",e.token),localStorage.setItem("role",(null===(s=e.user)||void 0===s?void 0:s.role)||"");r(r=>{var s;return(0,t.A)((0,t.A)({},r),{},{username:(null===(s=e.user)||void 0===s?void 0:s.username)||l})}),c(e.message||"Nom d\u2019utilisateur mis \xe0 jour")}catch(i){var a,n;h((null===(a=i.response)||void 0===a||null===(n=a.data)||void 0===n?void 0:n.error)||"Erreur mise \xe0 jour username")}},children:[(0,n.jsx)("h3",{children:"Changer mon nom d\u2019utilisateur (admin)"}),(0,n.jsx)("input",{value:l,onChange:e=>u(e.target.value),placeholder:"Nouveau nom d\u2019utilisateur",required:!0,style:{display:"block",marginBottom:8,width:"100%"}}),(0,n.jsx)("button",{type:"submit",children:"Mettre \xe0 jour le nom d\u2019utilisateur"})]})]})}}}]);
//# sourceMappingURL=658.cc70daf3.chunk.js.map