"use strict";(self.webpackChunkclient=self.webpackChunkclient||[]).push([[806],{806:(e,r,t)=>{t.r(r),t.d(r,{default:()=>a});var i=t(555),d=t(43),s=t(674),l=t(579);const a=function(){const[e,r]=(0,d.useState)([]),[t,a]=(0,d.useState)([]),[n,o]=(0,d.useState)(""),[c,u]=(0,d.useState)(""),[p,h]=(0,d.useState)([]),[m,g]=(0,d.useState)(""),[x,y]=(0,d.useState)("");(0,d.useEffect)(()=>{(async()=>{try{o(""),u("");const[e,t]=await Promise.all([s.A.get("/user"),s.A.get("/clubs")]);r(Array.isArray(e.data)?e.data:[]),a(Array.isArray(t.data)?t.data:[])}catch(i){var e,t;o((null===(e=i.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.error)||"Erreur chargement utilisateurs/clubs")}})(),j()},[]);const v=(e,r)=>(e.managerClubs||[]).some(e=>(e.id||e)===String(r)),j=async()=>{try{g(""),y("");const{data:e}=await s.A.get("/media/pending");h(Array.isArray(e)?e:[])}catch(t){var e,r;g((null===(e=t.response)||void 0===e||null===(r=e.data)||void 0===r?void 0:r.error)||"Erreur chargement m\xe9dias en attente")}},b=async(e,r)=>{try{g(""),y(""),await s.A.patch("/media/".concat(e,"/moderate"),{action:r}),h(r=>r.filter(r=>r.id!==e)),y("approve"===r?"Image approuv\xe9e":"Image rejet\xe9e")}catch(d){var t,i;g((null===(t=d.response)||void 0===t||null===(i=t.data)||void 0===i?void 0:i.error)||"Erreur mod\xe9ration")}};return(0,l.jsxs)("div",{children:[(0,l.jsx)("h2",{children:"\ud83c\udf9b\ufe0f Panel de contr\xf4le Admin"}),n&&(0,l.jsx)("div",{style:{color:"crimson",marginBottom:8},children:n}),c&&(0,l.jsx)("div",{style:{color:"seagreen",marginBottom:8},children:c}),(0,l.jsx)("h2",{style:{marginTop:24},children:"Gestion des utilisateurs"}),(0,l.jsx)("div",{style:{overflowX:"auto"},children:(0,l.jsxs)("table",{style:{borderCollapse:"collapse",minWidth:720},children:[(0,l.jsx)("thead",{children:(0,l.jsxs)("tr",{children:[(0,l.jsx)("th",{style:{textAlign:"left",borderBottom:"1px solid #ddd",padding:8},children:"Utilisateur"}),(0,l.jsx)("th",{style:{textAlign:"left",borderBottom:"1px solid #ddd",padding:8},children:"R\xf4le"}),(0,l.jsx)("th",{style:{textAlign:"left",borderBottom:"1px solid #ddd",padding:8},children:"Clubs g\xe9r\xe9s"})]})}),(0,l.jsxs)("tbody",{children:[e.map(e=>(0,l.jsxs)("tr",{children:[(0,l.jsx)("td",{style:{borderBottom:"1px solid #eee",padding:8},children:e.username}),(0,l.jsx)("td",{style:{borderBottom:"1px solid #eee",padding:8},children:e.role}),(0,l.jsx)("td",{style:{borderBottom:"1px solid #eee",padding:8},children:(0,l.jsx)("div",{style:{display:"flex",flexWrap:"wrap",gap:10},children:t.map(d=>{const a=v(e,d._id);return(0,l.jsxs)("label",{style:{display:"inline-flex",alignItems:"center",gap:6},children:[(0,l.jsx)("input",{type:"checkbox",checked:a,onChange:l=>(async(e,d,a)=>{try{o(""),u("");const l=a?"add":"remove";await s.A.post("/user/".concat(e,"/manager-clubs"),{clubId:d,action:l}),r(r=>r.map(r=>{if(r.id!==e)return r;const s=v(r,d);if(a&&!s){const e=t.find(e=>String(e._id)===String(d));return(0,i.A)((0,i.A)({},r),{},{managerClubs:[...r.managerClubs||[],{id:String(d),clubName:null===e||void 0===e?void 0:e.clubName}]})}return!a&&s?(0,i.A)((0,i.A)({},r),{},{managerClubs:(r.managerClubs||[]).filter(e=>(e.id||e)!==String(d))}):r})),u("Droits mis \xe0 jour")}catch(l){var n,c;o((null===(n=l.response)||void 0===n||null===(c=n.data)||void 0===c?void 0:c.error)||"Erreur mise \xe0 jour droits")}})(e.id,d._id,l.target.checked)}),(0,l.jsx)("span",{children:d.clubName})]},d._id)})})})]},e.id)),0===e.length&&(0,l.jsx)("tr",{children:(0,l.jsx)("td",{colSpan:3,style:{padding:8,color:"#666"},children:"Aucun utilisateur."})})]})]})}),(0,l.jsx)("h2",{style:{marginTop:24},children:"Mod\xe9ration des images"}),m&&(0,l.jsx)("div",{style:{color:"crimson",marginBottom:8},children:m}),x&&(0,l.jsx)("div",{style:{color:"seagreen",marginBottom:8},children:x}),(0,l.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(220px,1fr))",gap:12},children:[p.map(e=>{var r,t;return(0,l.jsxs)("div",{style:{border:"1px solid #ddd",borderRadius:8,padding:8},children:[(0,l.jsxs)("div",{style:{fontSize:12,color:"#666"},children:["#",e.id.slice(-6)," \u2022 nsfwProb: ",null!==(r=null===(t=e.flags)||void 0===t?void 0:t.nsfwProb)&&void 0!==r?r:"?"]}),(0,l.jsx)("div",{style:{margin:"6px 0"},children:(0,l.jsx)("img",{src:"".concat(s.A.defaults.baseURL.replace(/\/$/,""),"/media/").concat(e.id,"/raw"),alt:"pending",style:{width:"100%",height:140,objectFit:"cover",borderRadius:6}})}),(0,l.jsxs)("div",{style:{display:"flex",gap:8},children:[(0,l.jsx)("button",{className:"week-btn",onClick:()=>b(e.id,"approve"),children:"Approuver"}),(0,l.jsx)("button",{className:"week-btn",onClick:()=>b(e.id,"reject"),children:"Rejeter"})]})]},e.id)}),0===p.length&&(0,l.jsx)("div",{style:{color:"#666"},children:"Aucune image en attente"})]})]})}}}]);
//# sourceMappingURL=806.b54b8c90.chunk.js.map