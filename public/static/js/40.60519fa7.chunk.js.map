{"version":3,"file":"static/js/40.60519fa7.chunk.js","mappings":"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","sources":["components/games/mmorpg/Mmorpg.js"],"sourcesContent":["import React, { useEffect, useMemo, useRef, useState } from 'react';\r\nimport { Link } from 'react-router-dom';\r\nimport { io } from 'socket.io-client';\r\nimport API from '../../../api';\r\n\r\nfunction Cell({ here, you, name }) {\r\n  const bg = you ? '#16a34a' : here ? '#2563eb' : '#e5e7eb';\r\n  return (\r\n    <div\r\n      style={{ width: 16, height: 16, background: bg, border: '1px solid #fff', boxSizing: 'border-box' }}\r\n      title={name}\r\n    />\r\n  );\r\n}\r\n\r\nexport default function Mmorpg() {\r\n  const [me, setMe] = useState(null);\r\n  const [guilds, setGuilds] = useState([]);\r\n  const [name, setName] = useState('');\r\n  const [gname, setGname] = useState('');\r\n  const [err, setErr] = useState('');\r\n  const [zone, setZone] = useState('plaine');\r\n  const [players, setPlayers] = useState([]);\r\n  const [creating, setCreating] = useState(false);\r\n  const socketRef = useRef(null);\r\n\r\n  // Charger mon perso\r\n  useEffect(() => {\r\n    (async () => {\r\n      try {\r\n        const { data } = await API.get('/mmorpg/me');\r\n        setMe(data);\r\n        setName(data?.name || '');\r\n        if (data?.zone) setZone(data.zone);\r\n      } catch {}\r\n    })();\r\n  }, []);\r\n\r\n  // Charger guildes\r\n  useEffect(() => {\r\n    (async () => {\r\n      try {\r\n        const { data: list } = await API.get('/mmorpg/guilds');\r\n        setGuilds(Array.isArray(list) ? list : []);\r\n      } catch {}\r\n    })();\r\n  }, []);\r\n\r\n  // Socket\r\n  useEffect(() => {\r\n    const token = localStorage.getItem('token');\r\n    if (!token) return;\r\n    const s = io('http://localhost:5000/mmorpg', { transports: ['websocket'], auth: { token } });\r\n    socketRef.current = s;\r\n\r\n    s.on('zone_state', (payload) => {\r\n      setZone(payload.zone);\r\n      setPlayers(payload.players || []);\r\n    });\r\n    s.on('player_join', (p) => setPlayers((arr) => [...arr, p]));\r\n    s.on('player_move', (p) => setPlayers((arr) => arr.map((x) => (x.name === p.name ? { ...x, x: p.x, y: p.y } : x))));\r\n    s.on('player_leave', (p) => setPlayers((arr) => arr.filter((x) => x.name !== p.name)));\r\n    s.on('error_msg', (m) => setErr(m));\r\n\r\n    return () => s.disconnect();\r\n  }, []);\r\n\r\n  const saveName = async () => {\r\n    try {\r\n      setErr('');\r\n      const { data } = await API.post('/mmorpg/character', { name });\r\n      setMe(data);\r\n    } catch (e) {\r\n      setErr(e.response?.data?.error || 'Erreur');\r\n    }\r\n  };\r\n\r\n  const createGuild = async () => {\r\n    try {\r\n      setErr('');\r\n      const { data } = await API.post('/mmorpg/guilds', { name: gname });\r\n      setMe((m) => ({ ...(m || {}), guild: data.guild, zone: `city:${data.guild._id}`, x: 10, y: 10 }));\r\n      setZone(`city:${data.guild._id}`);\r\n      const { data: list } = await API.get('/mmorpg/guilds');\r\n      setGuilds(list);\r\n      socketRef.current?.emit('change_zone', { zone: `city:${data.guild._id}` });\r\n    } catch (e) {\r\n      setErr(e.response?.data?.error || 'Erreur création guilde');\r\n    }\r\n  };\r\n\r\n  const joinGuild = async (id) => {\r\n    try {\r\n      setErr('');\r\n      const { data } = await API.post(`/mmorpg/guilds/${id}/join`);\r\n      setMe((m) => ({ ...(m || {}), guild: data.guild, zone: `city:${data.guild._id}`, x: 10, y: 10 }));\r\n      setZone(`city:${data.guild._id}`);\r\n      socketRef.current?.emit('change_zone', { zone: `city:${data.guild._id}` });\r\n    } catch (e) {\r\n      setErr(e.response?.data?.error || 'Erreur rejoindre guilde');\r\n    }\r\n  };\r\n\r\n  const createCity = async () => {\r\n    try {\r\n      setCreating(true);\r\n      await API.post('/mmorpg/cities/create');\r\n      // rafraîchir mon état pour récupérer guild.city\r\n      const meRes = await API.get('/mmorpg/me');\r\n      setMe(meRes.data);\r\n      // se téléporter dans la ville nouvellement créée\r\n      if (meRes?.data?.guild?._id) {\r\n        socketRef.current?.emit('change_zone', { zone: `city:${meRes.data.guild._id}` });\r\n      }\r\n    } catch (e) {\r\n      setErr(e.response?.data?.error || 'Erreur création ville');\r\n    } finally {\r\n      setCreating(false);\r\n    }\r\n  };\r\n\r\n  // Déplacements clavier\r\n  useEffect(() => {\r\n    const onKey = (e) => {\r\n      const map = {\r\n        ArrowUp: [0, -1], ArrowDown: [0, 1], ArrowLeft: [-1, 0], ArrowRight: [1, 0],\r\n        w: [0, -1], s: [0, 1], a: [-1, 0], d: [1, 0],\r\n      };\r\n      const mv = map[e.key];\r\n      if (!mv) return;\r\n      socketRef.current?.emit('move', { dx: mv[0], dy: mv[1] });\r\n    };\r\n    window.addEventListener('keydown', onKey);\r\n    return () => window.removeEventListener('keydown', onKey);\r\n  }, []);\r\n\r\n  const youName = me?.name || '';\r\n  const grid = useMemo(() => {\r\n    const size = 50;\r\n    const mat = Array.from({ length: size }, () => Array.from({ length: size }, () => null));\r\n    players.forEach((p) => {\r\n      if (p.x >= 0 && p.x < size && p.y >= 0 && p.y < size) {\r\n        mat[p.y][p.x] = p;\r\n      }\r\n    });\r\n    return mat;\r\n  }, [players]);\r\n\r\n  return (\r\n    <div className=\"card\">\r\n      <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>\r\n        <h2 style={{ margin: 0 }}>MMORPG (alpha)</h2>\r\n        <div style={{ display: 'flex', gap: 8 }}>\r\n          <span className=\"pill pill--info\">Zone: {zone}</span>\r\n          <Link className=\"week-btn\" to=\"/games\">↩ Menu</Link>\r\n        </div>\r\n      </div>\r\n\r\n      {err && <div style={{ color: 'crimson', margin: '8px 0' }}>{err}</div>}\r\n\r\n      {/* Profil rapide */}\r\n      <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: 12, marginTop: 12 }}>\r\n        <div className=\"card\">\r\n          <h3 style={{ marginTop: 0 }}>Personnage</h3>\r\n          <label>\r\n            Nom\r\n            <input value={name} onChange={(e) => setName(e.target.value)} placeholder=\"Nom du perso\" />\r\n          </label>\r\n          <button className=\"week-btn\" onClick={saveName} style={{ marginTop: 8 }}>Enregistrer</button>\r\n          <div style={{ marginTop: 8, color: 'var(--muted)' }}>\r\n            {me?.guild ? <>Guilde: <b>{me.guild.name}</b></> : 'Pas de guilde'}\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"card\">\r\n          <h3 style={{ marginTop: 0 }}>Guildes</h3>\r\n          {!me?.guild && (\r\n            <>\r\n              <label>\r\n                Créer une guilde\r\n                <input value={gname} onChange={(e) => setGname(e.target.value)} placeholder=\"Nom de la guilde\" />\r\n              </label>\r\n              <button className=\"week-btn\" onClick={createGuild} style={{ marginTop: 8 }}>Créer</button>\r\n            </>\r\n          )}\r\n          <div style={{ marginTop: 8 }}>\r\n            <div style={{ fontWeight: 600, marginBottom: 6 }}>Rejoindre</div>\r\n            <div style={{ display: 'flex', gap: 8, flexWrap: 'wrap' }}>\r\n              {guilds.map((g) => (\r\n                <button key={g._id} className=\"week-btn\" onClick={() => joinGuild(g._id)} disabled={!!me?.guild}>\r\n                  {g.name} ({g.members?.length || 0})\r\n                </button>\r\n              ))}\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Actions de ville */}\r\n      {me?.guild && !me?.guild?.city && (\r\n        <div style={{ marginTop: 12 }}>\r\n          <button className=\"week-btn\" onClick={createCity} disabled={creating}>\r\n            {creating ? 'Création...' : `Créer la ville de ${me.guild.name}`}\r\n          </button>\r\n        </div>\r\n      )}\r\n\r\n      {/* Monde simple 50x50 */}\r\n      <div style={{ marginTop: 12, overflow: 'auto', border: '1px solid var(--line)', borderRadius: 8 }}>\r\n        <div style={{ display: 'grid', gridTemplateColumns: `repeat(${grid[0]?.length || 50}, 16px)` }}>\r\n          {grid.flatMap((row, y) =>\r\n            row.map((p, x) => (\r\n              <Cell key={`${x}-${y}`} here={!!p} you={p?.name === youName} name={p?.name} />\r\n            ))\r\n          )}\r\n        </div>\r\n      </div>\r\n\r\n      {/* Voyager */}\r\n      <div style={{ marginTop: 12, display: 'flex', gap: 8 }}>\r\n        <button className=\"week-btn\" onClick={() => socketRef.current?.emit('change_zone', { zone: 'plaine' })}>\r\n          Sortir en plaine\r\n        </button>\r\n        {me?.guild && (\r\n          <button\r\n            className=\"week-btn\"\r\n            onClick={() => socketRef.current?.emit('change_zone', { zone: `city:${me.guild._id}` })}\r\n          >\r\n            Aller à la ville de {me.guild.name}\r\n          </button>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n}"],"names":["Cell","_ref","here","you","name","bg","_jsx","style","width","height","background","border","boxSizing","title","Mmorpg","_me$guild","_grid$","me","setMe","useState","guilds","setGuilds","setName","gname","setGname","err","setErr","zone","setZone","players","setPlayers","creating","setCreating","socketRef","useRef","useEffect","data","API","get","_unused","list","Array","isArray","_unused2","token","localStorage","getItem","s","io","transports","auth","current","on","payload","p","arr","map","x","_objectSpread","y","filter","m","disconnect","onKey","e","_socketRef$current4","mv","ArrowUp","ArrowDown","ArrowLeft","ArrowRight","w","a","d","key","emit","dx","dy","window","addEventListener","removeEventListener","youName","grid","useMemo","mat","from","length","forEach","_jsxs","className","children","display","justifyContent","alignItems","margin","gap","Link","to","color","gridTemplateColumns","marginTop","value","onChange","target","placeholder","onClick","async","post","_e$response","_e$response$data","response","error","guild","_Fragment","_socketRef$current","concat","_id","_e$response2","_e$response2$data","fontWeight","marginBottom","flexWrap","g","_g$members","_socketRef$current2","id","_e$response3","_e$response3$data","joinGuild","disabled","members","city","_meRes$data","_meRes$data$guild","meRes","_socketRef$current3","_e$response4","_e$response4$data","overflow","borderRadius","flatMap","row","_socketRef$current5","_socketRef$current6"],"sourceRoot":""}