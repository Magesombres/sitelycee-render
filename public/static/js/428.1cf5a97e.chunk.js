"use strict";(self.webpackChunkclient=self.webpackChunkclient||[]).push([[428],{179:(e,t,n)=>{n.d(t,{O3:()=>c,Rl:()=>s,t0:()=>l});var a=n(43);n(579);const o={theme:{mode:"system"},ui:{pxPerMin:1.2,dayMinW:240,hoursColW:72,colGap:8,colPad:6,slotHoverMinH:128,monthCellH:120,monthCellPad:6},schedule:{days:5,timeStart:"08:00",timeEnd:"19:00",showNowLine:!0},events:{days:7},ab:{}};const r=(0,a.createContext)({settings:o,updateSettings:()=>{}});function l(){return(0,a.useContext)(r)}function s(e){if(!e||"string"!==typeof e)return;const[t,n]=e.split(":").map(Number);return Number.isNaN(t)||Number.isNaN(n)?void 0:60*t+n}function c(e){const t=(null===e||void 0===e?void 0:e.ui)||{},n=(e,t)=>"number"!==typeof e||Number.isNaN(e)?t:e,a=n(t.pxPerMin,1.2),o=n(t.hoursColW,72),r=n(t.dayMinW,240),l=n(t.colGap,8),s=n(t.colPad,6),c=n(t.slotHoverMinH,128),i=n(t.monthCellH,120),u=n(t.monthCellPad,6);return{"--px-per-min":String(a),"--hours-col-w":"".concat(o,"px"),"--day-min-w":"".concat(r,"px"),"--col-gap":"".concat(l,"px"),"--col-pad":"".concat(s,"px"),"--slot-hover-min-h":"".concat(c,"px"),"--month-cell-h":"".concat(i,"px"),"--month-cell-pad":"".concat(u,"px")}}},428:(e,t,n)=>{n.r(t),n.d(t,{default:()=>x});var a=n(555),o=n(43),r=n(674),l=n(179),s=n(579);const c=["Lundi","Mardi","Mercredi","Jeudi","Vendredi"];function i(e){if(!e)return 0;const[t,n]=e.split(":").map(Number);return 60*t+(n||0)}function u(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Date;const t=new Date(e);t.setHours(0,0,0,0);const n=t.getDay(),a=0===n?-6:1-n;return t.setDate(t.getDate()+a),t}function d(e){const t=new Date(e);return t.setDate(t.getDate()+4),"Semaine du ".concat(e.toLocaleDateString()," au ").concat(t.toLocaleDateString())}function h(e){const t=function(e){if(!e)return null;const t=e.replace("#",""),n=3===t.length?t.split("").map(e=>e+e).join(""):t,a=parseInt(n.slice(0,2),16),o=parseInt(n.slice(2,4),16),r=parseInt(n.slice(4,6),16);return[a,o,r].some(e=>Number.isNaN(e))?null:{r:a,g:o,b:r}}(e);if(!t)return{text:"#111111",muted:"rgba(17,17,17,0.7)",shadow:"none"};var n,a,o;return(n=t.r,a=t.g,o=t.b,(299*n+587*a+114*o)/1e3)>=186?{text:"#111111",muted:"rgba(17,17,17,0.6)",shadow:"0 1px 0 rgba(255,255,255,0.5)"}:{text:"#ffffff",muted:"rgba(255,255,255,0.75)",shadow:"0 1px 0 rgba(0,0,0,0.4)"}}function m(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:480,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1140,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1.2;const r=c.reduce((e,t)=>(0,a.A)((0,a.A)({},e),{},{[t]:[]}),{});e.forEach(e=>{r[e.day]&&r[e.day].push(e)});const l={};return c.forEach(e=>{const s=r[e].map(e=>{const o=Math.max(i(e.startHour),t),r=Math.min(i(e.endHour),n);return(0,a.A)((0,a.A)({},e),{},{start:o,end:r})}).filter(e=>e.end>e.start).sort((e,t)=>e.start-t.start||e.end-t.end);let c=[],u=-1;const d=new Set,m=new Map,p=[];s.forEach(e=>{var n;n=e.start,c=c.filter(e=>!(e.end<=n)||(d.delete(e._col),!1)),0===c.length&&(d.clear(),u+=1);let r=0;for(;d.has(r);)r+=1;d.add(r),c.push((0,a.A)((0,a.A)({},e),{},{_col:r}));const l=Math.max(r+1,m.get(u)||0);m.set(u,l);const s=e.color&&/^#([0-9a-f]{3}){1,2}$/i.test(e.color)?e.color:null,i=function(e){const t=[["#DBEAFE","#1E3A8A"],["#DCFCE7","#065F46"],["#FCE7F3","#9D174D"],["#FEF3C7","#92400E"],["#EDE9FE","#5B21B6"]];let n=0;for(let r=0;r<e.length;r++)n=31*n+e.charCodeAt(r)|0;const[a,o]=t[Math.abs(n)%t.length];return{bg:a,border:o}}(e.subject||""),v=s||i.bg,g=s?function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.2;try{const n=e.replace("#",""),a=parseInt(n.slice(0,2),16),o=parseInt(n.slice(2,4),16),r=parseInt(n.slice(4,6),16),l=Math.max(0,Math.min(255,Math.floor(a*(1-t)))),s=Math.max(0,Math.min(255,Math.floor(o*(1-t)))),c=Math.max(0,Math.min(255,Math.floor(r*(1-t))));return"#".concat(l.toString(16).padStart(2,"0")).concat(s.toString(16).padStart(2,"0")).concat(c.toString(16).padStart(2,"0"))}catch(n){return"#999999"}}(s,.35):i.border,{text:f,muted:x,shadow:y}=h(v);p.push((0,a.A)((0,a.A)({},e),{},{clusterId:u,col:r,top:(e.start-t)*o,height:(e.end-e.start)*o,style:{backgroundColor:v,borderColor:g,textColor:f,mutedColor:x,textShadow:y}}))});const v=Object.fromEntries(m.entries());p.forEach(e=>{const t=v[e.clusterId]||1;e.width=100/t,e.left=100*e.col/t}),l[e]=p}),l}function p(e,t){const n=new Date(e);return n.setDate(n.getDate()+t),n.setHours(0,0,0,0),n}function v(e,t){return e.getFullYear()===t.getFullYear()&&e.getMonth()===t.getMonth()&&e.getDate()===t.getDate()}function g(e){const t=e.getFullYear(),n=String(e.getMonth()+1).padStart(2,"0"),a=String(e.getDate()).padStart(2,"0");return"".concat(t,"-").concat(n,"-").concat(a)}function f(e){const t=new Date(e);return t.setHours(0,0,0,0),u(t)}const x=function(){var e,t,n,i,h,x,y,b,j,w,C,A;const[S,D]=(0,o.useState)([]),[M,N]=(0,o.useState)([]),[E,H]=(0,o.useState)([]),[k,B]=(0,o.useState)({day:"Lundi",startHour:"",endHour:"",subject:"",location:"",color:"#DBEAFE",status:"normal",weekType:""}),[T,L]=(0,o.useState)(""),[_,F]=(0,o.useState)(()=>u()),[I,P]=(0,o.useState)(()=>{const e=localStorage.getItem("abBaseMonday"),t=localStorage.getItem("abBaseType")||"A";return{monday:e?new Date(e):u(),type:"B"===t?"B":"A"}}),Y=(0,o.useMemo)(()=>function(e,t,n){const a=f(e).getTime(),o=f(t).getTime();return Math.floor((a-o)/6048e5)%2===0?n:"A"===n?"B":"A"}(_,I.monday,I.type),[_,I]);(0,o.useEffect)(()=>{R(),W()},[]);const R=async()=>{try{const e=await r.A.get("/schedule");D(e.data),L("")}catch(e){L("Erreur chargement emploi du temps")}},W=async()=>{try{var e;const n=(null===(e=(await r.A.get("/user/me")).data)||void 0===e?void 0:e.pinnedEvents)||[];if(n.length){var t;const e=await r.A.get("/events?limit=500"),a=new Map;n.forEach(e=>a.set(String(e),!0));const o=((null===(t=e.data)||void 0===t?void 0:t.events)||e.data||[]).filter(e=>a.get(String(e._id)));N(o)}else N([])}catch(n){}},q=(0,o.useMemo)(()=>{const e={1:"Lundi",2:"Mardi",3:"Mercredi",4:"Jeudi",5:"Vendredi",6:"Samedi",0:"Dimanche"};return M.map(t=>{var n;const a=new Date(t.date),o=e[a.getDay()];return{_id:"PIN-"+t._id,day:o,startHour:t.startHour||"08:00",endHour:t.endHour||(t.startHour?t.startHour:"09:00"),subject:t.title,location:t.location||(null!==(n=t.club)&&void 0!==n&&n.clubName?"Club "+t.club.clubName:""),color:t.color||"#FCD34D"}}).filter(e=>c.includes(e.day))},[M]),J=(0,o.useMemo)(()=>S.concat(q),[S,q]);(0,o.useEffect)(()=>{(async()=>{try{const e=g(_),t=g(p(_,6)),{data:n}=await r.A.get("/schedule/exceptions",{params:{start:e,end:t}});H(n||[])}catch(e){}})()},[_]);const O=e=>{B((0,a.A)((0,a.A)({},k),{},{[e.target.name]:e.target.value}))},{settings:V}=(0,l.t0)(),G=null!==(e=(0,l.Rl)(null===V||void 0===V||null===(t=V.schedule)||void 0===t?void 0:t.timeStart))&&void 0!==e?e:480,X=null!==(n=(0,l.Rl)(null===V||void 0===V||null===(i=V.schedule)||void 0===i?void 0:i.timeEnd))&&void 0!==n?n:1140,z=null!==(h=null===V||void 0===V||null===(x=V.ui)||void 0===x?void 0:x.pxPerMin)&&void 0!==h?h:1.2,[$,K]=(0,o.useState)(1),Q=(0,o.useRef)(null),U=(0,o.useRef)(!1),Z=(0,o.useRef)({x:0,y:0,left:0,top:0}),ee=e=>{if(!U.current)return;const t=Q.current;if(!t)return;const n=e.clientX-Z.current.x,a=e.clientY-Z.current.y;t.scrollLeft=Z.current.left-n,t.scrollTop=Z.current.top-a},te=()=>{U.current=!1;const e=Q.current;e&&(e.style.cursor="grab"),window.removeEventListener("mousemove",ee),window.removeEventListener("mouseup",te)},ne=(0,o.useMemo)(()=>J.filter(e=>!e.weekType||e.weekType===Y),[J,Y]),ae=(0,o.useMemo)(()=>m(ne,G,X,z),[ne,G,X,z]),oe=new Date,re=c[(oe.getDay()+6)%7],le=60*oe.getHours()+oe.getMinutes(),se=(null===(y=null===V||void 0===V||null===(b=V.schedule)||void 0===b?void 0:b.showNowLine)||void 0===y||y)&&le>=G&&le<=X,ce=e=>{localStorage.setItem("abBaseMonday",g(_)),localStorage.setItem("abBaseType",e),P({monday:_,type:e})},ie=(0,o.useMemo)(()=>Array.from({length:7},(e,t)=>p(_,t)),[_]);return(0,s.jsxs)("div",{className:"schedule-wrap",style:(0,a.A)((0,a.A)({},(0,l.O3)(V)),{},{"--px-per-min":z*$,"--day-min-w":"".concat(null!==(j=null===V||void 0===V||null===(w=V.ui)||void 0===w?void 0:w.dayMinW)&&void 0!==j?j:240,"px"),"--col-pad":"".concat(null!==(C=null===V||void 0===V||null===(A=V.ui)||void 0===A?void 0:A.colPad)&&void 0!==C?C:6,"px")}),children:[(0,s.jsxs)("div",{className:"week-head",children:[(0,s.jsx)("h2",{children:"Mon emploi du temps"}),(0,s.jsxs)("span",{className:"badge badge-ab",style:{marginLeft:8},children:["Semaine ",Y]}),(0,s.jsxs)("div",{className:"actions",children:[(0,s.jsx)("button",{className:"week-btn",onClick:()=>{const e=new Date(_);e.setDate(e.getDate()-7),F(e)},children:"\u27f5 Semaine pr\xe9c\xe9dente"}),(0,s.jsx)("button",{className:"week-btn",onClick:()=>{const e=new Date(_);e.setDate(e.getDate()+7),F(e)},children:"Semaine suivante \u27f6"}),(0,s.jsx)("button",{className:"week-btn",onClick:()=>ce("A"),title:"D\xe9finir la semaine affich\xe9e comme A",children:"D\xe9finir comme A"}),(0,s.jsx)("button",{className:"week-btn",onClick:()=>ce("B"),title:"D\xe9finir la semaine affich\xe9e comme B",children:"D\xe9finir comme B"})]})]}),(0,s.jsx)("div",{style:{color:"var(--muted)",marginBottom:12},children:d(_)}),T&&(0,s.jsx)("div",{style:{color:"crimson",marginBottom:12},children:T}),(0,s.jsx)("div",{className:"grid-scroll",ref:Q,onWheel:e=>{e.preventDefault();const t=Q.current;if(!t)return;const n=t.getBoundingClientRect(),a=e.clientY-n.top+t.scrollTop,o=$,r=(l=o*(e.deltaY<0?1.1:.9),s=.6,c=3,Math.max(s,Math.min(c,l)));var l,s,c;if(r===o)return;const i=a*(r/o)-(e.clientY-n.top);K(r),requestAnimationFrame(()=>{t.scrollTop=i})},onMouseDown:e=>{const t=Q.current;t&&(U.current=!0,Z.current={x:e.clientX,y:e.clientY,left:t.scrollLeft,top:t.scrollTop},t.style.cursor="grabbing",window.addEventListener("mousemove",ee),window.addEventListener("mouseup",te))},style:{cursor:"grab"},children:(0,s.jsxs)("div",{className:"schedule-grid",children:[(0,s.jsx)("div",{className:"hours-col","aria-hidden":"true",children:Array.from({length:X-G},(e,t)=>t).filter(e=>e%60===0).map(e=>{const t=Math.floor((G+e)/60),n=String((G+e)%60).padStart(2,"0");return(0,s.jsxs)("div",{className:"hour-label",children:[String(t).padStart(2,"0"),":",n]},e)})}),c.map((e,t)=>{var n,o,l;const c=ie[t];return(0,s.jsxs)("div",{className:"day-col",children:[(0,s.jsx)("div",{className:"day-header",children:e}),(0,s.jsxs)("div",{className:"day-content",children:[e===re&&se&&(0,s.jsx)("div",{className:"now-line",style:{top:(le-G)*(null!==(n=null===V||void 0===V||null===(o=V.ui)||void 0===o?void 0:o.pxPerMin)&&void 0!==n?n:1.2)}}),null===(l=ae[e])||void 0===l?void 0:l.map(t=>{var n;const o=E.find(e=>e.schedule===t._id&&v(new Date(e.date),c)),l=(null===o||void 0===o?void 0:o.status)||"normal",i="annule"===l?{opacity:.6,filter:"grayscale(0.3)",borderStyle:"dashed"}:"prof_absent"===l?{borderStyle:"dashed"}:{};return(0,s.jsxs)("div",{className:"slot",style:(0,a.A)({"--slot-top":"".concat(t.top,"px"),"--slot-height":"".concat(t.height,"px"),"--slot-left":"calc(".concat(t.left,"% + var(--col-pad))"),"--slot-width":"calc(".concat(t.width,"% - (var(--col-pad) * 2))"),backgroundColor:t.style.backgroundColor,border:"1px solid ".concat(t.style.borderColor),color:t.style.textColor,textShadow:t.style.textShadow},i),title:"".concat(t.subject," \u2022 ").concat(t.startHour,"\u2013").concat(t.endHour).concat(t.location?" @ ".concat(t.location):""),children:[(0,s.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",gap:8,alignItems:"center"},children:[(0,s.jsx)("div",{className:"slot-title",children:t.subject}),(0,s.jsxs)("div",{className:"slot-badges",children:[t.weekType?(0,s.jsx)("span",{className:"badge badge-ab",children:t.weekType}):(0,s.jsx)("span",{className:"badge badge-all",children:"A/B"}),"annule"===l&&(0,s.jsx)("span",{className:"badge badge-annule",children:"Annul\xe9"}),"prof_absent"===l&&(0,s.jsx)("span",{className:"badge badge-prof",children:"Prof absent"})]})]}),(0,s.jsxs)("div",{className:"slot-time",style:{color:t.style.mutedColor},children:[t.startHour," \u2013 ",t.endHour]}),t.location&&(0,s.jsxs)("div",{className:"slot-loc",style:{color:t.style.mutedColor},children:["@ ",t.location]}),(0,s.jsxs)("div",{className:"slot-controls",children:[(0,s.jsxs)("select",{value:l,onChange:e=>(async(e,t,n)=>{try{const a=g(t),{data:o}=await r.A.patch("/schedule/".concat(e,"/status-on-date"),{date:a,status:n});H(n=>{const a=n.findIndex(n=>n.schedule===e&&v(new Date(n.date),t));if(a>=0){const e=n.slice();return e[a]=o,e}return[...n,o]})}catch(a){L("Erreur mise \xe0 jour \xe9tat (jour)")}})(t._id,c,e.target.value),title:"\xc9tat du cours (pour ce jour)",children:[(0,s.jsx)("option",{value:"normal",children:"Normal"}),(0,s.jsx)("option",{value:"annule",children:"Cours annul\xe9"}),(0,s.jsx)("option",{value:"prof_absent",children:"Prof absent"})]}),(0,s.jsxs)("label",{title:"Changer la couleur",style:{cursor:"pointer"},children:["\ud83c\udfa8",(0,s.jsx)("input",{type:"color",value:(null===(n=S.find(e=>e._id===t._id))||void 0===n?void 0:n.color)||t.style.backgroundColor,onChange:e=>(async(e,t)=>{try{const{data:n}=await r.A.patch("/schedule/".concat(e,"/color"),{color:t});if(Array.isArray(n.updated))D(n.updated);else{const n=S.find(t=>t._id===e);n&&D(e=>e.map(e=>e.subject===n.subject?(0,a.A)((0,a.A)({},e),{},{color:t}):e))}}catch(n){L("Erreur mise \xe0 jour couleur")}})(t._id,e.target.value),style:{width:0,height:0,opacity:0,position:"absolute"}})]}),(0,s.jsx)("button",{onClick:()=>(async e=>{try{await r.A.delete("/schedule/".concat(e)),R(),L("")}catch(t){L("Erreur suppression")}})(t._id),style:{background:"transparent",border:"none",color:t.style.mutedColor,cursor:"pointer"},"aria-label":"Supprimer",title:"Supprimer",children:"\ud83d\uddd1\ufe0f"})]})]},t._id+"-"+e)})]})]},e)})]})}),(0,s.jsx)("h3",{style:{marginTop:16},children:"Ajouter un cours"}),(0,s.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),k.subject&&k.startHour&&k.endHour)if(k.startHour>=k.endHour)L("L'heure de d\xe9but doit \xeatre avant l'heure de fin.");else try{const e=(0,a.A)({},k);e.weekType||delete e.weekType,await r.A.post("/schedule",e),R(),B({day:"Lundi",startHour:"",endHour:"",subject:"",location:"",color:"#DBEAFE",status:"normal",weekType:""}),L("")}catch(s){var t,n,o,l;L((null===(t=s.response)||void 0===t||null===(n=t.data)||void 0===n?void 0:n.error)||(null===(o=s.response)||void 0===o||null===(l=o.data)||void 0===l?void 0:l.message)||"Erreur ajout")}else L("Veuillez remplir tous les champs obligatoires.")},style:{display:"grid",gridTemplateColumns:"repeat(8, minmax(140px, 1fr))",gap:8},children:[(0,s.jsxs)("label",{children:["Jour",(0,s.jsx)("select",{name:"day",value:k.day,onChange:O,children:c.map(e=>(0,s.jsx)("option",{children:e},e))})]}),(0,s.jsxs)("label",{children:["D\xe9but",(0,s.jsx)("input",{name:"startHour",type:"time",min:"08:00",max:"19:00",step:"300",value:k.startHour,onChange:O,required:!0})]}),(0,s.jsxs)("label",{children:["Fin",(0,s.jsx)("input",{name:"endHour",type:"time",min:"08:00",max:"19:00",step:"300",value:k.endHour,onChange:O,required:!0})]}),(0,s.jsxs)("label",{children:["Mati\xe8re",(0,s.jsx)("input",{name:"subject",placeholder:"Mati\xe8re",value:k.subject,onChange:O,required:!0})]}),(0,s.jsxs)("label",{children:["Lieu (facultatif)",(0,s.jsx)("input",{name:"location",placeholder:"Lieu",value:k.location,onChange:O})]}),(0,s.jsxs)("label",{children:["Couleur",(0,s.jsx)("input",{name:"color",type:"color",value:k.color,onChange:O})]}),(0,s.jsxs)("label",{children:["Semaine",(0,s.jsxs)("select",{name:"weekType",value:k.weekType,onChange:e=>B(t=>(0,a.A)((0,a.A)({},t),{},{weekType:e.target.value})),children:[(0,s.jsx)("option",{value:"",children:"Toutes (A & B)"}),(0,s.jsx)("option",{value:"A",children:"A"}),(0,s.jsx)("option",{value:"B",children:"B"})]})]}),(0,s.jsxs)("label",{children:["\xc9tat (par d\xe9faut)",(0,s.jsxs)("select",{name:"status",value:k.status,onChange:O,children:[(0,s.jsx)("option",{value:"normal",children:"Normal"}),(0,s.jsx)("option",{value:"annule",children:"Cours annul\xe9"}),(0,s.jsx)("option",{value:"prof_absent",children:"Prof absent"})]})]}),(0,s.jsx)("div",{style:{gridColumn:"1 / -1"},children:(0,s.jsx)("button",{type:"submit",children:"Ajouter"})})]})]})}}}]);
//# sourceMappingURL=428.1cf5a97e.chunk.js.map