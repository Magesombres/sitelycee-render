{"version":3,"file":"static/js/806.b54b8c90.chunk.js","mappings":"mKAqKA,QAlKA,WAEE,MAAOA,EAAOC,IAAYC,EAAAA,EAAAA,UAAS,KAC5BC,EAAOC,IAAYF,EAAAA,EAAAA,UAAS,KAC5BG,EAAMC,IAAWJ,EAAAA,EAAAA,UAAS,KAC1BK,EAAMC,IAAWN,EAAAA,EAAAA,UAAS,KAG1BO,EAAcC,IAAmBR,EAAAA,EAAAA,UAAS,KAC1CS,EAAMC,IAAWV,EAAAA,EAAAA,UAAS,KAC1BW,EAAMC,IAAWZ,EAAAA,EAAAA,UAAS,KAgBjCa,EAAAA,EAAAA,WAAU,KAdiBC,WACzB,IACEV,EAAQ,IAAKE,EAAQ,IACrB,MAAOS,EAAMC,SAAcC,QAAQC,IAAI,CACrCC,EAAAA,EAAIC,IAAI,SACRD,EAAAA,EAAIC,IAAI,YAEVrB,EAASsB,MAAMC,QAAQP,EAAKQ,MAAQR,EAAKQ,KAAO,IAChDrB,EAASmB,MAAMC,QAAQN,EAAKO,MAAQP,EAAKO,KAAO,GAClD,CAAE,MAAOC,GAAI,IAADC,EAAAC,EACVtB,GAAkB,QAAVqB,EAAAD,EAAEG,gBAAQ,IAAAF,GAAM,QAANC,EAAVD,EAAYF,YAAI,IAAAG,OAAN,EAAVA,EAAkBE,QAAS,uCACrC,GAIAC,GACFC,KACG,IAEH,MAAMC,EAAcA,CAACC,EAAMC,KACZD,EAAKE,cAAgB,IACtBC,KAAMC,IAAOA,EAAEC,IAAMD,KAAOE,OAAOL,IAiC3CH,EAAoBhB,UACxB,IACEJ,EAAQ,IAAKE,EAAQ,IACrB,MAAM,KAAEW,SAAeJ,EAAAA,EAAIC,IAAI,kBAC/BZ,EAAgBa,MAAMC,QAAQC,GAAQA,EAAO,GAC/C,CAAE,MAAOC,GAAI,IAADe,EAAAC,EACV9B,GAAkB,QAAV6B,EAAAf,EAAEG,gBAAQ,IAAAY,GAAM,QAANC,EAAVD,EAAYhB,YAAI,IAAAiB,OAAN,EAAVA,EAAkBZ,QAAS,yCACrC,GAGIa,EAAW3B,MAAOuB,EAAIK,KAC1B,IACEhC,EAAQ,IAAKE,EAAQ,UACfO,EAAAA,EAAIwB,MAAM,UAADC,OAAWP,EAAE,aAAa,CAAEK,WAC3ClC,EAAiBqC,GAAQA,EAAIC,OAAQC,GAAMA,EAAEV,KAAOA,IACpDzB,EAAmB,YAAX8B,EAAuB,qBAAoB,mBACrD,CAAE,MAAOlB,GAAI,IAADwB,EAAAC,EACVvC,GAAkB,QAAVsC,EAAAxB,EAAEG,gBAAQ,IAAAqB,GAAM,QAANC,EAAVD,EAAYzB,YAAI,IAAA0B,OAAN,EAAVA,EAAkBrB,QAAS,uBACrC,GAGF,OACEsB,EAAAA,EAAAA,MAAA,OAAAC,SAAA,EACEC,EAAAA,EAAAA,KAAA,MAAAD,SAAI,kDACHhD,IAAQiD,EAAAA,EAAAA,KAAA,OAAKC,MAAO,CAAEC,MAAO,UAAWC,aAAc,GAAIJ,SAAEhD,IAC5DE,IAAQ+C,EAAAA,EAAAA,KAAA,OAAKC,MAAO,CAAEC,MAAO,WAAYC,aAAc,GAAIJ,SAAE9C,KAE9D+C,EAAAA,EAAAA,KAAA,MAAIC,MAAO,CAAEG,UAAW,IAAKL,SAAC,8BAC9BC,EAAAA,EAAAA,KAAA,OAAKC,MAAO,CAAEI,UAAW,QAASN,UAChCD,EAAAA,EAAAA,MAAA,SAAOG,MAAO,CAAEK,eAAgB,WAAYC,SAAU,KAAMR,SAAA,EAC1DC,EAAAA,EAAAA,KAAA,SAAAD,UACED,EAAAA,EAAAA,MAAA,MAAAC,SAAA,EACEC,EAAAA,EAAAA,KAAA,MAAIC,MAAO,CAAEO,UAAW,OAAQC,aAAc,iBAAkBC,QAAS,GAAIX,SAAC,iBAC9EC,EAAAA,EAAAA,KAAA,MAAIC,MAAO,CAAEO,UAAW,OAAQC,aAAc,iBAAkBC,QAAS,GAAIX,SAAC,aAC9EC,EAAAA,EAAAA,KAAA,MAAIC,MAAO,CAAEO,UAAW,OAAQC,aAAc,iBAAkBC,QAAS,GAAIX,SAAC,4BAGlFD,EAAAA,EAAAA,MAAA,SAAAC,SAAA,CACGrD,EAAMiE,IAAKC,IACVd,EAAAA,EAAAA,MAAA,MAAAC,SAAA,EACEC,EAAAA,EAAAA,KAAA,MAAIC,MAAO,CAAEQ,aAAc,iBAAkBC,QAAS,GAAIX,SAAEa,EAAEC,YAC9Db,EAAAA,EAAAA,KAAA,MAAIC,MAAO,CAAEQ,aAAc,iBAAkBC,QAAS,GAAIX,SAAEa,EAAEE,QAC9Dd,EAAAA,EAAAA,KAAA,MAAIC,MAAO,CAAEQ,aAAc,iBAAkBC,QAAS,GAAIX,UACxDC,EAAAA,EAAAA,KAAA,OAAKC,MAAO,CAAEc,QAAS,OAAQC,SAAU,OAAQC,IAAK,IAAKlB,SACxDlD,EAAM8D,IAAK3B,IACV,MAAMkC,EAAUvC,EAAYiC,EAAG5B,EAAEmC,KACjC,OACErB,EAAAA,EAAAA,MAAA,SAAmBG,MAAO,CAAEc,QAAS,cAAeK,WAAY,SAAUH,IAAK,GAAIlB,SAAA,EACjFC,EAAAA,EAAAA,KAAA,SACEqB,KAAK,WACLH,QAASA,EACTI,SAAWlD,GAjFXV,OAAO6D,EAAQ1C,EAAQqC,KAC/C,IACElE,EAAQ,IAAKE,EAAQ,IACrB,MAAMoC,EAAS4B,EAAU,MAAQ,eAC3BnD,EAAAA,EAAIyD,KAAK,SAADhC,OAAU+B,EAAM,kBAAkB,CAAE1C,SAAQS,WAE1D3C,EAAU8C,GAAQA,EAAIkB,IAAKC,IACzB,GAAIA,EAAE3B,KAAOsC,EAAQ,OAAOX,EAC5B,MAAMa,EAAM9C,EAAYiC,EAAG/B,GAC3B,GAAIqC,IAAYO,EAAK,CACnB,MAAMC,EAAO7E,EAAM8E,KAAM3C,GAAME,OAAOF,EAAEmC,OAASjC,OAAOL,IACxD,OAAA+C,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GACKhB,GAAC,IACJ9B,aAAc,IAAK8B,EAAE9B,cAAgB,GAAK,CAAEG,GAAIC,OAAOL,GAASgD,SAAc,OAAJH,QAAI,IAAJA,OAAI,EAAJA,EAAMG,YAEpF,CACA,OAAKX,GAAWO,GACdG,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GACKhB,GAAC,IACJ9B,cAAe8B,EAAE9B,cAAgB,IAAIY,OAAQV,IAAOA,EAAEC,IAAMD,KAAOE,OAAOL,MAGvE+B,KAET1D,EAAQ,uBACV,CAAE,MAAOkB,GAAI,IAAD0D,EAAAC,EACV/E,GAAkB,QAAV8E,EAAA1D,EAAEG,gBAAQ,IAAAuD,GAAM,QAANC,EAAVD,EAAY3D,YAAI,IAAA4D,OAAN,EAAVA,EAAkBvD,QAAS,+BACrC,GAsDyCwD,CAAkBpB,EAAE3B,GAAID,EAAEmC,IAAK/C,EAAE6D,OAAOf,YAE3DlB,EAAAA,EAAAA,KAAA,QAAAD,SAAOf,EAAE6C,aANC7C,EAAEmC,aARfP,EAAE3B,KAsBK,IAAjBvC,EAAMwF,SACLlC,EAAAA,EAAAA,KAAA,MAAAD,UAAIC,EAAAA,EAAAA,KAAA,MAAImC,QAAS,EAAGlC,MAAO,CAAES,QAAS,EAAGR,MAAO,QAASH,SAAC,kCAMlEC,EAAAA,EAAAA,KAAA,MAAIC,MAAO,CAAEG,UAAW,IAAKL,SAAC,6BAC7B1C,IAAQ2C,EAAAA,EAAAA,KAAA,OAAKC,MAAO,CAAEC,MAAO,UAAWC,aAAc,GAAIJ,SAAE1C,IAC5DE,IAAQyC,EAAAA,EAAAA,KAAA,OAAKC,MAAO,CAAEC,MAAO,WAAYC,aAAc,GAAIJ,SAAExC,KAC9DuC,EAAAA,EAAAA,MAAA,OAAKG,MAAO,CAAEc,QAAS,OAAQqB,oBAAqB,uCAAwCnB,IAAK,IAAKlB,SAAA,CACnG5C,EAAawD,IAAKhB,IAAC,IAAA0C,EAAAC,EAAA,OAClBxC,EAAAA,EAAAA,MAAA,OAAgBG,MAAO,CAAEsC,OAAQ,iBAAkBC,aAAc,EAAG9B,QAAS,GAAIX,SAAA,EAC/ED,EAAAA,EAAAA,MAAA,OAAKG,MAAO,CAAEwC,SAAU,GAAIvC,MAAO,QAASH,SAAA,CAAC,IAAEJ,EAAEV,GAAGyD,OAAO,GAAG,qBAA+B,QAAlBL,EAAQ,QAARC,EAAC3C,EAAEgD,aAAK,IAAAL,OAAA,EAAPA,EAASM,gBAAQ,IAAAP,EAAAA,EAAI,QACjGrC,EAAAA,EAAAA,KAAA,OAAKC,MAAO,CAAE4C,OAAQ,SAAU9C,UAC9BC,EAAAA,EAAAA,KAAA,OACE8C,IAAG,GAAAtD,OAAKzB,EAAAA,EAAIgF,SAASC,QAAQC,QAAQ,MAAM,IAAG,WAAAzD,OAAUG,EAAEV,GAAE,QAC5DiE,IAAI,UACJjD,MAAO,CAAEkD,MAAO,OAAQC,OAAQ,IAAKC,UAAW,QAASb,aAAc,QAG3E1C,EAAAA,EAAAA,MAAA,OAAKG,MAAO,CAAEc,QAAS,OAAQE,IAAK,GAAIlB,SAAA,EACtCC,EAAAA,EAAAA,KAAA,UAAQsD,UAAU,WAAWC,QAASA,IAAMlE,EAASM,EAAEV,GAAI,WAAWc,SAAC,eACvEC,EAAAA,EAAAA,KAAA,UAAQsD,UAAU,WAAWC,QAASA,IAAMlE,EAASM,EAAEV,GAAI,UAAUc,SAAC,iBAXhEJ,EAAEV,MAeW,IAAxB9B,EAAa+E,SACZlC,EAAAA,EAAAA,KAAA,OAAKC,MAAO,CAAEC,MAAO,QAASH,SAAC,iCAKzC,C","sources":["components/AdminPanel.js"],"sourcesContent":["import React, { useEffect, useState } from 'react';\r\nimport API from '../api';\r\n\r\nfunction AdminPanel() {\r\n  // Gestion des utilisateurs ⇩\r\n  const [users, setUsers] = useState([]);\r\n  const [clubs, setClubs] = useState([]);\r\n  const [uerr, setUerr] = useState('');\r\n  const [umsg, setUmsg] = useState('');\r\n\r\n  // Media moderation ⇩\r\n  const [pendingMedia, setPendingMedia] = useState([]);\r\n  const [merr, setMerr] = useState('');\r\n  const [mmsg, setMmsg] = useState('');\r\n\r\n  const fetchUsersAndClubs = async () => {\r\n    try {\r\n      setUerr(''); setUmsg('');\r\n      const [uRes, cRes] = await Promise.all([\r\n        API.get('/user'),      // GET (admin) liste users\r\n        API.get('/clubs'),     // liste clubs\r\n      ]);\r\n      setUsers(Array.isArray(uRes.data) ? uRes.data : []);\r\n      setClubs(Array.isArray(cRes.data) ? cRes.data : []);\r\n    } catch (e) {\r\n      setUerr(e.response?.data?.error || 'Erreur chargement utilisateurs/clubs');\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    fetchUsersAndClubs();\r\n  fetchPendingMedia();\r\n  }, []);\r\n\r\n  const userHasClub = (user, clubId) => {\r\n    const list = user.managerClubs || [];\r\n    return list.some((c) => (c.id || c) === String(clubId));\r\n  };\r\n\r\n  const toggleClubForUser = async (userId, clubId, checked) => {\r\n    try {\r\n      setUerr(''); setUmsg('');\r\n      const action = checked ? 'add' : 'remove';\r\n      await API.post(`/user/${userId}/manager-clubs`, { clubId, action });\r\n      // MàJ locale\r\n      setUsers((arr) => arr.map((u) => {\r\n        if (u.id !== userId) return u;\r\n        const has = userHasClub(u, clubId);\r\n        if (checked && !has) {\r\n          const club = clubs.find((c) => String(c._id) === String(clubId));\r\n          return {\r\n            ...u,\r\n            managerClubs: [...(u.managerClubs || []), { id: String(clubId), clubName: club?.clubName }],\r\n          };\r\n        }\r\n        if (!checked && has) {\r\n          return {\r\n            ...u,\r\n            managerClubs: (u.managerClubs || []).filter((c) => (c.id || c) !== String(clubId)),\r\n          };\r\n        }\r\n        return u;\r\n      }));\r\n      setUmsg('Droits mis à jour');\r\n    } catch (e) {\r\n      setUerr(e.response?.data?.error || 'Erreur mise à jour droits');\r\n    }\r\n  };\r\n\r\n  const fetchPendingMedia = async () => {\r\n    try {\r\n      setMerr(''); setMmsg('');\r\n      const { data } = await API.get('/media/pending');\r\n      setPendingMedia(Array.isArray(data) ? data : []);\r\n    } catch (e) {\r\n      setMerr(e.response?.data?.error || 'Erreur chargement médias en attente');\r\n    }\r\n  };\r\n\r\n  const moderate = async (id, action) => {\r\n    try {\r\n      setMerr(''); setMmsg('');\r\n      await API.patch(`/media/${id}/moderate`, { action });\r\n      setPendingMedia((arr) => arr.filter((m) => m.id !== id));\r\n      setMmsg(action === 'approve' ? 'Image approuvée' : 'Image rejetée');\r\n    } catch (e) {\r\n      setMerr(e.response?.data?.error || 'Erreur modération');\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div>\r\n      <h2>🎛️ Panel de contrôle Admin</h2>\r\n      {uerr && <div style={{ color: 'crimson', marginBottom: 8 }}>{uerr}</div>}\r\n      {umsg && <div style={{ color: 'seagreen', marginBottom: 8 }}>{umsg}</div>}\r\n\r\n      <h2 style={{ marginTop: 24 }}>Gestion des utilisateurs</h2>\r\n      <div style={{ overflowX: 'auto' }}>\r\n        <table style={{ borderCollapse: 'collapse', minWidth: 720 }}>\r\n          <thead>\r\n            <tr>\r\n              <th style={{ textAlign: 'left', borderBottom: '1px solid #ddd', padding: 8 }}>Utilisateur</th>\r\n              <th style={{ textAlign: 'left', borderBottom: '1px solid #ddd', padding: 8 }}>Rôle</th>\r\n              <th style={{ textAlign: 'left', borderBottom: '1px solid #ddd', padding: 8 }}>Clubs gérés</th>\r\n            </tr>\r\n          </thead>\r\n          <tbody>\r\n            {users.map((u) => (\r\n              <tr key={u.id}>\r\n                <td style={{ borderBottom: '1px solid #eee', padding: 8 }}>{u.username}</td>\r\n                <td style={{ borderBottom: '1px solid #eee', padding: 8 }}>{u.role}</td>\r\n                <td style={{ borderBottom: '1px solid #eee', padding: 8 }}>\r\n                  <div style={{ display: 'flex', flexWrap: 'wrap', gap: 10 }}>\r\n                    {clubs.map((c) => {\r\n                      const checked = userHasClub(u, c._id);\r\n                      return (\r\n                        <label key={c._id} style={{ display: 'inline-flex', alignItems: 'center', gap: 6 }}>\r\n                          <input\r\n                            type=\"checkbox\"\r\n                            checked={checked}\r\n                            onChange={(e) => toggleClubForUser(u.id, c._id, e.target.checked)}\r\n                          />\r\n                          <span>{c.clubName}</span>\r\n                        </label>\r\n                      );\r\n                    })}\r\n                  </div>\r\n                </td>\r\n              </tr>\r\n            ))}\r\n            {users.length === 0 && (\r\n              <tr><td colSpan={3} style={{ padding: 8, color: '#666' }}>Aucun utilisateur.</td></tr>\r\n            )}\r\n          </tbody>\r\n        </table>\r\n      </div>\r\n\r\n      <h2 style={{ marginTop: 24 }}>Modération des images</h2>\r\n      {merr && <div style={{ color: 'crimson', marginBottom: 8 }}>{merr}</div>}\r\n      {mmsg && <div style={{ color: 'seagreen', marginBottom: 8 }}>{mmsg}</div>}\r\n      <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fill, minmax(220px,1fr))', gap: 12 }}>\r\n        {pendingMedia.map((m) => (\r\n          <div key={m.id} style={{ border: '1px solid #ddd', borderRadius: 8, padding: 8 }}>\r\n            <div style={{ fontSize: 12, color: '#666' }}>#{m.id.slice(-6)} • nsfwProb: {m.flags?.nsfwProb ?? '?'}</div>\r\n            <div style={{ margin: '6px 0' }}>\r\n              <img\r\n                src={`${API.defaults.baseURL.replace(/\\/$/,'')}/media/${m.id}/raw`}\r\n                alt=\"pending\"\r\n                style={{ width: '100%', height: 140, objectFit: 'cover', borderRadius: 6 }}\r\n              />\r\n            </div>\r\n            <div style={{ display: 'flex', gap: 8 }}>\r\n              <button className=\"week-btn\" onClick={() => moderate(m.id, 'approve')}>Approuver</button>\r\n              <button className=\"week-btn\" onClick={() => moderate(m.id, 'reject')}>Rejeter</button>\r\n            </div>\r\n          </div>\r\n        ))}\r\n        {pendingMedia.length === 0 && (\r\n          <div style={{ color: '#666' }}>Aucune image en attente</div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default AdminPanel;\r\n"],"names":["users","setUsers","useState","clubs","setClubs","uerr","setUerr","umsg","setUmsg","pendingMedia","setPendingMedia","merr","setMerr","mmsg","setMmsg","useEffect","async","uRes","cRes","Promise","all","API","get","Array","isArray","data","e","_e$response","_e$response$data","response","error","fetchUsersAndClubs","fetchPendingMedia","userHasClub","user","clubId","managerClubs","some","c","id","String","_e$response3","_e$response3$data","moderate","action","patch","concat","arr","filter","m","_e$response4","_e$response4$data","_jsxs","children","_jsx","style","color","marginBottom","marginTop","overflowX","borderCollapse","minWidth","textAlign","borderBottom","padding","map","u","username","role","display","flexWrap","gap","checked","_id","alignItems","type","onChange","userId","post","has","club","find","_objectSpread","clubName","_e$response2","_e$response2$data","toggleClubForUser","target","length","colSpan","gridTemplateColumns","_m$flags$nsfwProb","_m$flags","border","borderRadius","fontSize","slice","flags","nsfwProb","margin","src","defaults","baseURL","replace","alt","width","height","objectFit","className","onClick"],"sourceRoot":""}