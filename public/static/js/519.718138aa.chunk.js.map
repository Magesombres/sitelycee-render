{"version":3,"file":"static/js/519.718138aa.chunk.js","mappings":"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","sources":["components/Chat.js","components/MediaUpload.js"],"sourcesContent":["import React, { useEffect, useRef, useState, useCallback } from 'react';\r\nimport API from '../api';\r\nimport MediaUpload from './MediaUpload';\r\n\r\n// Basic chat component: global + group rooms\r\nexport default function Chat() {\r\n  const token = localStorage.getItem('token');\r\n  const myId = (()=>{ try { const t = token?.split('.')[1]; if(!t) return null; const p = JSON.parse(atob(t.replace(/-/g,'+').replace(/_/g,'/'))); return p.id||p.userId||p._id||null; } catch { return null; } })();\r\n  const [rooms, setRooms] = useState([]); // {id,name,members[]}\r\n  const [activeRoom, setActiveRoom] = useState('global');\r\n  const [messages, setMessages] = useState([]);\r\n  const [input, setInput] = useState('');\r\n  const [status, setStatus] = useState('');\r\n  const [pendingImageUrl, setPendingImageUrl] = useState('');\r\n  const socketRef = useRef(null);\r\n  const bottomRef = useRef(null);\r\n  const typingRef = useRef({});\r\n  const [typingUsers, setTypingUsers] = useState([]);\r\n\r\n  const fetchRooms = useCallback(async () => {\r\n    try {\r\n      const { data } = await API.get('/chat/rooms');\r\n      setRooms(data);\r\n    } catch (e) {\r\n      setStatus('Erreur chargement salles');\r\n    }\r\n  }, []);\r\n\r\n  const fetchMessages = useCallback(async (roomId) => {\r\n    try {\r\n      const { data } = await API.get(`/chat/rooms/${roomId}/messages`);\r\n      setMessages(data);\r\n    } catch (e) {\r\n      setMessages([]);\r\n    }\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    if (!token) return;\r\n    fetchRooms();\r\n    let s;\r\n    let cancelled = false;\r\n    (async () => {\r\n      try {\r\n        const base = API?.defaults?.baseURL?.replace(/\\/$/, '') || '';\r\n        const wsUrl = base.replace(/^http/, 'ws') + '/chat';\r\n        const { io } = await import('socket.io-client');\r\n        if (cancelled) return;\r\n        s = io(wsUrl, { auth: { token } });\r\n        socketRef.current = s;\r\n\r\n        s.on('connected', () => setStatus('ConnectÃ©'));\r\n        s.on('message', (msg) => {\r\n          setMessages((prev) => prev.concat(msg));\r\n        });\r\n        s.on('error_msg', (m) => setStatus(m));\r\n        s.on('messageDeleted', ({ id }) => {\r\n          setMessages((prev) => prev.filter((m) => m.id !== id));\r\n        });\r\n        s.on('joined', ({ roomId }) => {\r\n          if (roomId === activeRoom) fetchMessages(roomId);\r\n        });\r\n        s.on('typing', ({ user, typing }) => {\r\n          typingRef.current[user] = typing ? Date.now() : 0;\r\n          const list = Object.entries(typingRef.current)\r\n            .filter(([, ts]) => ts && Date.now() - ts < 4000)\r\n            .map(([u]) => u);\r\n          setTypingUsers(list);\r\n        });\r\n      } catch (err) {\r\n        setStatus('Connexion temps rÃ©el indisponible');\r\n      }\r\n    })();\r\n    return () => { cancelled = true; if (s) s.disconnect(); };\r\n  }, [token, fetchRooms, fetchMessages, activeRoom]);\r\n\r\n  useEffect(() => { bottomRef.current?.scrollIntoView({ behavior: 'smooth' }); }, [messages]);\r\n\r\n  useEffect(() => { if (activeRoom) fetchMessages(activeRoom); }, [activeRoom, fetchMessages]);\r\n\r\n  const send = (e) => {\r\n    e.preventDefault();\r\n    if (!input.trim() && !pendingImageUrl) return;\r\n    socketRef.current?.emit('message', { roomId: activeRoom, content: input, imageUrl: pendingImageUrl });\r\n    setInput('');\r\n    setPendingImageUrl('');\r\n  };\r\n\r\n  const onInput = (e) => {\r\n    setInput(e.target.value);\r\n    socketRef.current?.emit('typing', { roomId: activeRoom, typing: true });\r\n  };\r\n\r\n  const createRoom = async () => {\r\n    const name = prompt('Nom du groupe ?');\r\n    if (!name) return;\r\n    try {\r\n      const { data } = await API.post('/chat/rooms', { name });\r\n      setRooms((r) => r.concat(data));\r\n      setActiveRoom(data.id);\r\n    } catch {\r\n      setStatus('Erreur crÃ©ation salle');\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div style={{ display: 'flex', height: '85vh', gap: 16 }}>\r\n      <aside style={{ width: 280, borderRight: '1px solid var(--line)', display: 'flex', flexDirection: 'column' }}>\r\n        <div style={{ padding: 8, fontWeight: 'bold' }}>Salles</div>\r\n        <div style={{ flex: 1, overflowY: 'auto' }}>\r\n          {rooms.map((r) => (\r\n            <div\r\n              key={r.id}\r\n              onClick={() => setActiveRoom(r.id)}\r\n              style={{ cursor: 'pointer', padding: '6px 10px', background: activeRoom === r.id ? 'var(--accent-soft)' : 'transparent' }}\r\n            >{r.name}</div>\r\n          ))}\r\n        </div>\r\n        <button onClick={createRoom} style={{ margin: 8 }}>+ Groupe</button>\r\n      </aside>\r\n      <main style={{ flex: 1, display: 'flex', flexDirection: 'column' }}>\r\n        <div style={{ padding: '4px 8px', borderBottom: '1px solid var(--line)', display: 'flex', justifyContent: 'space-between' }}>\r\n          <strong>{rooms.find(r=>r.id===activeRoom)?.name || 'GÃ©nÃ©ral'}</strong>\r\n          <span style={{ fontSize: 12, color: 'var(--muted)' }}>{status}</span>\r\n        </div>\r\n  <div style={{ flex: 1, overflowY: 'auto', padding: 12, background: 'var(--panel)' }}>\r\n          {messages.map(m => {\r\n            const dt = new Date(m.createdAt);\r\n            const hh = String(dt.getHours()).padStart(2,'0');\r\n            const mm = String(dt.getMinutes()).padStart(2,'0');\r\n            return (\r\n              <div key={m.id} style={{ marginBottom: 6, display:'flex', gap:8 }}>\r\n                <span style={{ color: 'var(--muted)', fontSize: 11, marginRight: 4 }}>[{hh}:{mm}]</span>\r\n                <span style={{ fontWeight: 'bold' }}>{m.username}: </span>\r\n                <div style={{ flex:1 }}>\r\n                  <span style={{ whiteSpace: 'pre-wrap' }}>{m.content}</span>\r\n                  {m.imageUrl && (\r\n                    <div>\r\n                      <img loading=\"lazy\" src={m.imageUrl.startsWith('/') ? (API.defaults.baseURL.replace(/\\/$/,'') + m.imageUrl) : m.imageUrl} alt=\"img\" style={{ maxWidth: 360, borderRadius: 8, marginTop: 6 }} />\r\n                    </div>\r\n                  )}\r\n                </div>\r\n                {(m.user === myId) && (\r\n                  <button\r\n                    className=\"week-btn\"\r\n                    title=\"Supprimer\"\r\n                    onClick={async ()=>{\r\n                      try {\r\n                        await API.delete(`/chat/messages/${m.id}`);\r\n                        setMessages((prev)=> prev.filter(x=> x.id!==m.id));\r\n                      } catch { setStatus('Suppression impossible'); }\r\n                    }}\r\n                  >ðï¸</button>\r\n                )}\r\n              </div>\r\n            );\r\n          })}\r\n          <div ref={bottomRef} />\r\n        </div>\r\n        {typingUsers.length > 0 && (\r\n          <div style={{ padding: '2px 10px', fontSize: 12, color: 'var(--muted)' }}>\r\n            {typingUsers.join(', ')} Ã©crit...\r\n          </div>\r\n        )}\r\n        <form onSubmit={send} style={{ display: 'flex', gap: 12, padding: 12, alignItems:'flex-start' }}>\r\n          <textarea\r\n            value={input}\r\n            onChange={onInput}\r\n            onKeyDown={(e) => { if (e.key === 'Enter' && !e.shiftKey) { send(e); } }}\r\n            placeholder=\"Message (EntrÃ©e pour envoyer, Shift+EntrÃ©e pour nouvelle ligne)\"\r\n            style={{ flex: 1, resize: 'none', minHeight: 80 }}\r\n          />\r\n          <div style={{ display:'flex', flexDirection:'column', gap:8, width: 360, flexShrink: 0 }}>\r\n            <MediaUpload onUploaded={(d)=>{ if(d.status==='approved' && d.url){ const full = d.url.startsWith('/') ? (API.defaults.baseURL.replace(/\\/$/,'') + d.url) : d.url; setPendingImageUrl(full); } }} />\r\n            {pendingImageUrl && (\r\n              <div style={{ display:'flex', alignItems:'center', gap:6 }}>\r\n                <img src={pendingImageUrl} alt=\"preview\" style={{ width: 64, height: 64, objectFit:'cover', borderRadius: 6, flexShrink: 0 }} />\r\n                <button type=\"button\" onClick={()=> setPendingImageUrl('')}>Retirer</button>\r\n              </div>\r\n            )}\r\n            <button type=\"submit\">Envoyer</button>\r\n          </div>\r\n        </form>\r\n      </main>\r\n    </div>\r\n  );\r\n}\r\n","import React, { useRef, useState } from 'react';\r\nimport API from '../api';\r\n\r\nexport default function MediaUpload({ onUploaded, showPreview = true, previewSize = 64 }) {\r\n  const [file, setFile] = useState(null);\r\n  const [status, setStatus] = useState('');\r\n  const [preview, setPreview] = useState('');\r\n  const inputRef = useRef(null);\r\n\r\n  const submit = async (e) => {\r\n    e?.preventDefault?.();\r\n    if (!file) return;\r\n    setStatus('Envoi...');\r\n    const fd = new FormData();\r\n    fd.append('file', file);\r\n    try {\r\n  const { data } = await API.post('/media/image', fd, { headers: { 'Content-Type': 'multipart/form-data' } });\r\n  setStatus(data.status === 'approved' ? 'OK' : 'En attente modÃ©ration');\r\n  // Clear the initial local file and its preview\r\n  setFile(null);\r\n  if (inputRef.current) inputRef.current.value = '';\r\n  // After upload: show a small server-side preview only if approved (has public url)\r\n  const base = API?.defaults?.baseURL?.replace(/\\/$/, '') || '';\r\n  const absoluteUrl = data?.url ? (data.url.startsWith('/') ? (base + data.url) : data.url) : '';\r\n  setPreview(data.status === 'approved' && absoluteUrl ? absoluteUrl : '');\r\n  if (onUploaded) onUploaded({ ...data, absoluteUrl });\r\n    } catch (e2) {\r\n      const msg = e2.response?.data?.error || 'Erreur upload';\r\n      setStatus(msg);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div style={{ display: 'flex', flexDirection: 'column', gap: 8 }}>\r\n      <input\r\n        type=\"file\"\r\n        accept=\"image/png,image/jpeg,image/webp\"\r\n        ref={inputRef}\r\n        onChange={(e) => {\r\n          const f = e.target.files?.[0];\r\n          if (!f) return;\r\n          if (f.size > 2 * 1024 * 1024) { // client hint; server enforces too\r\n            setStatus('> 2MB refusÃ©'); return;\r\n          }\r\n          setFile(f);\r\n          setPreview(URL.createObjectURL(f));\r\n          setStatus('');\r\n        }}\r\n      />\r\n      {showPreview && preview && (\r\n        <img\r\n          src={preview}\r\n          alt=\"prÃ©visualisation\"\r\n          style={{ width: previewSize, height: previewSize, objectFit: 'cover', border: '1px solid var(--line)', borderRadius: 6 }}\r\n        />\r\n      )}\r\n      <button className=\"week-btn\" type=\"button\" onClick={submit} disabled={!file}>Uploader lâimage</button>\r\n      {status && <small style={{ color: 'var(--muted)' }}>{status}</small>}\r\n    </div>\r\n  );\r\n}\r\n"],"names":["Chat","_rooms$find","token","localStorage","getItem","myId","t","split","p","JSON","parse","atob","replace","id","userId","_id","_unused","rooms","setRooms","useState","activeRoom","setActiveRoom","messages","setMessages","input","setInput","status","setStatus","pendingImageUrl","setPendingImageUrl","socketRef","useRef","bottomRef","typingRef","typingUsers","setTypingUsers","fetchRooms","useCallback","async","data","API","get","e","fetchMessages","concat","roomId","useEffect","s","cancelled","_API$defaults","_API$defaults$baseURL","wsUrl","defaults","baseURL","io","auth","current","on","msg","prev","m","_ref","filter","_ref2","_ref3","user","typing","Date","now","list","Object","entries","_ref4","ts","map","_ref5","u","err","disconnect","_bottomRef$current","scrollIntoView","behavior","send","_socketRef$current","preventDefault","trim","emit","content","imageUrl","_jsxs","style","display","height","gap","children","width","borderRight","flexDirection","_jsx","padding","fontWeight","flex","overflowY","r","onClick","cursor","background","name","prompt","post","_unused2","margin","borderBottom","justifyContent","find","fontSize","color","dt","createdAt","hh","String","getHours","padStart","mm","getMinutes","marginBottom","marginRight","username","whiteSpace","loading","src","startsWith","alt","maxWidth","borderRadius","marginTop","className","title","delete","x","_unused3","ref","length","join","onSubmit","alignItems","value","onChange","_socketRef$current2","target","onKeyDown","key","shiftKey","placeholder","resize","minHeight","flexShrink","MediaUpload","onUploaded","d","url","full","objectFit","type","showPreview","previewSize","file","setFile","preview","setPreview","inputRef","accept","_e$target$files","f","files","size","URL","createObjectURL","border","_e$preventDefault","call","fd","FormData","append","headers","base","absoluteUrl","_objectSpread","e2","_e2$response","_e2$response$data","response","error","disabled"],"sourceRoot":""}