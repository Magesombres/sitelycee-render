"use strict";(self.webpackChunkclient=self.webpackChunkclient||[]).push([[40],{40:(e,n,l)=>{l.r(n),l.d(n,{default:()=>c});var i=l(555),a=l(43),r=l(924),t=l(104),o=l(674),d=l(579);function s(e){let{here:n,you:l,name:i}=e;const a=l?"#16a34a":n?"#2563eb":"#e5e7eb";return(0,d.jsx)("div",{style:{width:16,height:16,background:a,border:"1px solid #fff",boxSizing:"border-box"},title:i})}function c(){var e,n;const[l,c]=(0,a.useState)(null),[u,m]=(0,a.useState)([]),[g,v]=(0,a.useState)(""),[p,h]=(0,a.useState)(""),[y,x]=(0,a.useState)(""),[j,f]=(0,a.useState)("plaine"),[w,b]=(0,a.useState)([]),[k,A]=(0,a.useState)(!1),_=(0,a.useRef)(null);(0,a.useEffect)(()=>{(async()=>{try{const{data:e}=await o.A.get("/mmorpg/me");c(e),v((null===e||void 0===e?void 0:e.name)||""),null!==e&&void 0!==e&&e.zone&&f(e.zone)}catch(e){}})()},[]),(0,a.useEffect)(()=>{(async()=>{try{const{data:e}=await o.A.get("/mmorpg/guilds");m(Array.isArray(e)?e:[])}catch(e){}})()},[]),(0,a.useEffect)(()=>{const e=localStorage.getItem("token");if(!e)return;const n=(0,t.io)("http://localhost:5000/mmorpg",{transports:["websocket"],auth:{token:e}});return _.current=n,n.on("zone_state",e=>{f(e.zone),b(e.players||[])}),n.on("player_join",e=>b(n=>[...n,e])),n.on("player_move",e=>b(n=>n.map(n=>n.name===e.name?(0,i.A)((0,i.A)({},n),{},{x:e.x,y:e.y}):n))),n.on("player_leave",e=>b(n=>n.filter(n=>n.name!==e.name))),n.on("error_msg",e=>x(e)),()=>n.disconnect()},[]);(0,a.useEffect)(()=>{const e=e=>{var n;const l={ArrowUp:[0,-1],ArrowDown:[0,1],ArrowLeft:[-1,0],ArrowRight:[1,0],w:[0,-1],s:[0,1],a:[-1,0],d:[1,0]}[e.key];l&&(null===(n=_.current)||void 0===n||n.emit("move",{dx:l[0],dy:l[1]}))};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[]);const z=(null===l||void 0===l?void 0:l.name)||"",C=(0,a.useMemo)(()=>{const e=Array.from({length:50},()=>Array.from({length:50},()=>null));return w.forEach(n=>{n.x>=0&&n.x<50&&n.y>=0&&n.y<50&&(e[n.y][n.x]=n)}),e},[w]);return(0,d.jsxs)("div",{className:"card",children:[(0,d.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,d.jsx)("h2",{style:{margin:0},children:"MMORPG (alpha)"}),(0,d.jsxs)("div",{style:{display:"flex",gap:8},children:[(0,d.jsxs)("span",{className:"pill pill--info",children:["Zone: ",j]}),(0,d.jsx)(r.N_,{className:"week-btn",to:"/games",children:"\u21a9 Menu"})]})]}),y&&(0,d.jsx)("div",{style:{color:"crimson",margin:"8px 0"},children:y}),(0,d.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12,marginTop:12},children:[(0,d.jsxs)("div",{className:"card",children:[(0,d.jsx)("h3",{style:{marginTop:0},children:"Personnage"}),(0,d.jsxs)("label",{children:["Nom",(0,d.jsx)("input",{value:g,onChange:e=>v(e.target.value),placeholder:"Nom du perso"})]}),(0,d.jsx)("button",{className:"week-btn",onClick:async()=>{try{x("");const{data:e}=await o.A.post("/mmorpg/character",{name:g});c(e)}catch(l){var e,n;x((null===(e=l.response)||void 0===e||null===(n=e.data)||void 0===n?void 0:n.error)||"Erreur")}},style:{marginTop:8},children:"Enregistrer"}),(0,d.jsx)("div",{style:{marginTop:8,color:"var(--muted)"},children:null!==l&&void 0!==l&&l.guild?(0,d.jsxs)(d.Fragment,{children:["Guilde: ",(0,d.jsx)("b",{children:l.guild.name})]}):"Pas de guilde"})]}),(0,d.jsxs)("div",{className:"card",children:[(0,d.jsx)("h3",{style:{marginTop:0},children:"Guildes"}),!(null!==l&&void 0!==l&&l.guild)&&(0,d.jsxs)(d.Fragment,{children:[(0,d.jsxs)("label",{children:["Cr\xe9er une guilde",(0,d.jsx)("input",{value:p,onChange:e=>h(e.target.value),placeholder:"Nom de la guilde"})]}),(0,d.jsx)("button",{className:"week-btn",onClick:async()=>{try{var e;x("");const{data:n}=await o.A.post("/mmorpg/guilds",{name:p});c(e=>(0,i.A)((0,i.A)({},e||{}),{},{guild:n.guild,zone:"city:".concat(n.guild._id),x:10,y:10})),f("city:".concat(n.guild._id));const{data:l}=await o.A.get("/mmorpg/guilds");m(l),null===(e=_.current)||void 0===e||e.emit("change_zone",{zone:"city:".concat(n.guild._id)})}catch(a){var n,l;x((null===(n=a.response)||void 0===n||null===(l=n.data)||void 0===l?void 0:l.error)||"Erreur cr\xe9ation guilde")}},style:{marginTop:8},children:"Cr\xe9er"})]}),(0,d.jsxs)("div",{style:{marginTop:8},children:[(0,d.jsx)("div",{style:{fontWeight:600,marginBottom:6},children:"Rejoindre"}),(0,d.jsx)("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:u.map(e=>{var n;return(0,d.jsxs)("button",{className:"week-btn",onClick:()=>(async e=>{try{var n;x("");const{data:l}=await o.A.post("/mmorpg/guilds/".concat(e,"/join"));c(e=>(0,i.A)((0,i.A)({},e||{}),{},{guild:l.guild,zone:"city:".concat(l.guild._id),x:10,y:10})),f("city:".concat(l.guild._id)),null===(n=_.current)||void 0===n||n.emit("change_zone",{zone:"city:".concat(l.guild._id)})}catch(r){var l,a;x((null===(l=r.response)||void 0===l||null===(a=l.data)||void 0===a?void 0:a.error)||"Erreur rejoindre guilde")}})(e._id),disabled:!(null===l||void 0===l||!l.guild),children:[e.name," (",(null===(n=e.members)||void 0===n?void 0:n.length)||0,")"]},e._id)})})]})]})]}),(null===l||void 0===l?void 0:l.guild)&&!(null!==l&&void 0!==l&&null!==(e=l.guild)&&void 0!==e&&e.city)&&(0,d.jsx)("div",{style:{marginTop:12},children:(0,d.jsx)("button",{className:"week-btn",onClick:async()=>{try{var e,n;A(!0),await o.A.post("/mmorpg/cities/create");const i=await o.A.get("/mmorpg/me");var l;if(c(i.data),null!==i&&void 0!==i&&null!==(e=i.data)&&void 0!==e&&null!==(n=e.guild)&&void 0!==n&&n._id)null===(l=_.current)||void 0===l||l.emit("change_zone",{zone:"city:".concat(i.data.guild._id)})}catch(r){var i,a;x((null===(i=r.response)||void 0===i||null===(a=i.data)||void 0===a?void 0:a.error)||"Erreur cr\xe9ation ville")}finally{A(!1)}},disabled:k,children:k?"Cr\xe9ation...":"Cr\xe9er la ville de ".concat(l.guild.name)})}),(0,d.jsx)("div",{style:{marginTop:12,overflow:"auto",border:"1px solid var(--line)",borderRadius:8},children:(0,d.jsx)("div",{style:{display:"grid",gridTemplateColumns:"repeat(".concat((null===(n=C[0])||void 0===n?void 0:n.length)||50,", 16px)")},children:C.flatMap((e,n)=>e.map((e,l)=>(0,d.jsx)(s,{here:!!e,you:(null===e||void 0===e?void 0:e.name)===z,name:null===e||void 0===e?void 0:e.name},"".concat(l,"-").concat(n))))})}),(0,d.jsxs)("div",{style:{marginTop:12,display:"flex",gap:8},children:[(0,d.jsx)("button",{className:"week-btn",onClick:()=>{var e;return null===(e=_.current)||void 0===e?void 0:e.emit("change_zone",{zone:"plaine"})},children:"Sortir en plaine"}),(null===l||void 0===l?void 0:l.guild)&&(0,d.jsxs)("button",{className:"week-btn",onClick:()=>{var e;return null===(e=_.current)||void 0===e?void 0:e.emit("change_zone",{zone:"city:".concat(l.guild._id)})},children:["Aller \xe0 la ville de ",l.guild.name]})]})]})}}}]);
//# sourceMappingURL=40.60519fa7.chunk.js.map