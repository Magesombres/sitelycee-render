"use strict";(self.webpackChunkclient=self.webpackChunkclient||[]).push([[729],{179:(e,t,s)=>{s.d(t,{O3:()=>l,Rl:()=>a,t0:()=>o});var n=s(43);s(579);const r={theme:{mode:"system"},ui:{pxPerMin:1.2,dayMinW:240,hoursColW:72,colGap:8,colPad:6,slotHoverMinH:128,monthCellH:120,monthCellPad:6},schedule:{days:5,timeStart:"08:00",timeEnd:"19:00",showNowLine:!0},events:{days:7},ab:{}};const i=(0,n.createContext)({settings:r,updateSettings:()=>{}});function o(){return(0,n.useContext)(i)}function a(e){if(!e||"string"!==typeof e)return;const[t,s]=e.split(":").map(Number);return Number.isNaN(t)||Number.isNaN(s)?void 0:60*t+s}function l(e){const t=(null===e||void 0===e?void 0:e.ui)||{},s=(e,t)=>"number"!==typeof e||Number.isNaN(e)?t:e,n=s(t.pxPerMin,1.2),r=s(t.hoursColW,72),i=s(t.dayMinW,240),o=s(t.colGap,8),a=s(t.colPad,6),l=s(t.slotHoverMinH,128),c=s(t.monthCellH,120),u=s(t.monthCellPad,6);return{"--px-per-min":String(n),"--hours-col-w":"".concat(r,"px"),"--day-min-w":"".concat(i,"px"),"--col-gap":"".concat(o,"px"),"--col-pad":"".concat(a,"px"),"--slot-hover-min-h":"".concat(l,"px"),"--month-cell-h":"".concat(c,"px"),"--month-cell-pad":"".concat(u,"px")}}},729:(e,t,s)=>{s.r(t),s.d(t,{default:()=>xe});var n=s(555),r=s(43),i=s(674);var o,a,l,c,u,d,h,p,v,m,f,g,A,b,y,x,w=s(790),j=s(149),C=s(562),k=s(458),D=s(558),S=s(491),R=s(454),N=s(210),E=s(329),M=s(567),H=s(723),F=s(734),U=(o=new WeakMap,a=new WeakMap,l=new WeakMap,c=new WeakMap,u=new WeakMap,d=new WeakMap,h=new WeakMap,p=new WeakMap,v=new WeakMap,m=new WeakMap,f=new WeakMap,g=new WeakMap,A=new WeakMap,b=new WeakMap,y=new WeakMap,x=new WeakSet,class extends E.Q{constructor(e,t){super(),(0,w.A)(this,x),(0,j.A)(this,o,void 0),(0,j.A)(this,a,void 0),(0,j.A)(this,l,void 0),(0,j.A)(this,c,void 0),(0,j.A)(this,u,void 0),(0,j.A)(this,d,void 0),(0,j.A)(this,h,void 0),(0,j.A)(this,p,void 0),(0,j.A)(this,v,void 0),(0,j.A)(this,m,void 0),(0,j.A)(this,f,void 0),(0,j.A)(this,g,void 0),(0,j.A)(this,A,void 0),(0,j.A)(this,b,void 0),(0,j.A)(this,y,new Set),this.options=t,(0,D.A)(o,this,e),(0,D.A)(p,this,null),(0,D.A)(h,this,(0,M.T)()),this.bindMethods(),this.setOptions(t)}bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){1===this.listeners.size&&((0,k.A)(a,this).addObserver(this),B((0,k.A)(a,this),this.options)?(0,C.A)(x,this,O).call(this):this.updateResult(),(0,C.A)(x,this,T).call(this))}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return z((0,k.A)(a,this),this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return z((0,k.A)(a,this),this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,(0,C.A)(x,this,P).call(this),(0,C.A)(x,this,W).call(this),(0,k.A)(a,this).removeObserver(this)}setOptions(e){const t=this.options,s=(0,k.A)(a,this);if(this.options=(0,k.A)(o,this).defaultQueryOptions(e),void 0!==this.options.enabled&&"boolean"!==typeof this.options.enabled&&"function"!==typeof this.options.enabled&&"boolean"!==typeof(0,H.Eh)(this.options.enabled,(0,k.A)(a,this)))throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");(0,C.A)(x,this,q).call(this),(0,k.A)(a,this).setOptions(this.options),t._defaulted&&!(0,H.f8)(this.options,t)&&(0,k.A)(o,this).getQueryCache().notify({type:"observerOptionsUpdated",query:(0,k.A)(a,this),observer:this});const n=this.hasListeners();n&&Y((0,k.A)(a,this),s,this.options,t)&&(0,C.A)(x,this,O).call(this),this.updateResult(),!n||(0,k.A)(a,this)===s&&(0,H.Eh)(this.options.enabled,(0,k.A)(a,this))===(0,H.Eh)(t.enabled,(0,k.A)(a,this))&&(0,H.d2)(this.options.staleTime,(0,k.A)(a,this))===(0,H.d2)(t.staleTime,(0,k.A)(a,this))||(0,C.A)(x,this,I).call(this);const r=(0,C.A)(x,this,L).call(this);!n||(0,k.A)(a,this)===s&&(0,H.Eh)(this.options.enabled,(0,k.A)(a,this))===(0,H.Eh)(t.enabled,(0,k.A)(a,this))&&r===(0,k.A)(b,this)||(0,C.A)(x,this,_).call(this,r)}getOptimisticResult(e){const t=(0,k.A)(o,this).getQueryCache().build((0,k.A)(o,this),e),s=this.createResult(t,e);return function(e,t){if(!(0,H.f8)(e.getCurrentResult(),t))return!0;return!1}(this,s)&&((0,D.A)(c,this,s),(0,D.A)(d,this,this.options),(0,D.A)(u,this,(0,k.A)(a,this).state)),s}getCurrentResult(){return(0,k.A)(c,this)}trackResult(e,t){return new Proxy(e,{get:(e,s)=>(this.trackProp(s),null===t||void 0===t||t(s),"promise"!==s||this.options.experimental_prefetchInRender||"pending"!==(0,k.A)(h,this).status||(0,k.A)(h,this).reject(new Error("experimental_prefetchInRender feature flag is not enabled")),Reflect.get(e,s))})}trackProp(e){(0,k.A)(y,this).add(e)}getCurrentQuery(){return(0,k.A)(a,this)}refetch(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Object.assign({},(function(e){if(null==e)throw new TypeError("Cannot destructure "+e)}(e),e));return this.fetch((0,n.A)({},t))}fetchOptimistic(e){const t=(0,k.A)(o,this).defaultQueryOptions(e),s=(0,k.A)(o,this).getQueryCache().build((0,k.A)(o,this),t);return s.fetch().then(()=>this.createResult(s,t))}fetch(e){var t;return(0,C.A)(x,this,O).call(this,(0,n.A)((0,n.A)({},e),{},{cancelRefetch:null===(t=e.cancelRefetch)||void 0===t||t})).then(()=>(this.updateResult(),(0,k.A)(c,this)))}createResult(e,t){const s=(0,k.A)(a,this),r=this.options,i=(0,k.A)(c,this),o=(0,k.A)(u,this),g=(0,k.A)(d,this),A=e!==s?e.state:(0,k.A)(l,this),{state:b}=e;let y,x=(0,n.A)({},b),w=!1;if(t._optimisticResults){const i=this.hasListeners(),o=!i&&B(e,t),a=i&&Y(e,s,t,r);(o||a)&&(x=(0,n.A)((0,n.A)({},x),(0,N.k)(b.data,e.options))),"isRestoring"===t._optimisticResults&&(x.fetchStatus="idle")}let{error:j,errorUpdatedAt:C,status:S}=x;y=x.data;let R=!1;if(void 0!==t.placeholderData&&void 0===y&&"pending"===S){let e;var E;if(null!==i&&void 0!==i&&i.isPlaceholderData&&t.placeholderData===(null===g||void 0===g?void 0:g.placeholderData))e=i.data,R=!0;else e="function"===typeof t.placeholderData?t.placeholderData(null===(E=(0,k.A)(f,this))||void 0===E?void 0:E.state.data,(0,k.A)(f,this)):t.placeholderData;void 0!==e&&(S="success",y=(0,H.pl)(null===i||void 0===i?void 0:i.data,e,t),w=!0)}if(t.select&&void 0!==y&&!R)if(i&&y===(null===o||void 0===o?void 0:o.data)&&t.select===(0,k.A)(v,this))y=(0,k.A)(m,this);else try{(0,D.A)(v,this,t.select),y=t.select(y),y=(0,H.pl)(null===i||void 0===i?void 0:i.data,y,t),(0,D.A)(m,this,y),(0,D.A)(p,this,null)}catch(T){(0,D.A)(p,this,T)}(0,k.A)(p,this)&&(j=(0,k.A)(p,this),y=(0,k.A)(m,this),C=Date.now(),S="error");const F="fetching"===x.fetchStatus,U="pending"===S,O="error"===S,I=U&&F,L=void 0!==y,_={status:S,fetchStatus:x.fetchStatus,isPending:U,isSuccess:"success"===S,isError:O,isInitialLoading:I,isLoading:I,data:y,dataUpdatedAt:x.dataUpdatedAt,error:j,errorUpdatedAt:C,failureCount:x.fetchFailureCount,failureReason:x.fetchFailureReason,errorUpdateCount:x.errorUpdateCount,isFetched:x.dataUpdateCount>0||x.errorUpdateCount>0,isFetchedAfterMount:x.dataUpdateCount>A.dataUpdateCount||x.errorUpdateCount>A.errorUpdateCount,isFetching:F,isRefetching:F&&!U,isLoadingError:O&&!L,isPaused:"paused"===x.fetchStatus,isPlaceholderData:w,isRefetchError:O&&L,isStale:G(e,t),refetch:this.refetch,promise:(0,k.A)(h,this),isEnabled:!1!==(0,H.Eh)(t.enabled,e)};if(this.options.experimental_prefetchInRender){const t=e=>{"error"===_.status?e.reject(_.error):void 0!==_.data&&e.resolve(_.data)},n=()=>{const e=(0,D.A)(h,this,_.promise=(0,M.T)());t(e)},r=(0,k.A)(h,this);switch(r.status){case"pending":e.queryHash===s.queryHash&&t(r);break;case"fulfilled":"error"!==_.status&&_.data===r.value||n();break;case"rejected":"error"===_.status&&_.error===r.reason||n()}}return _}updateResult(){const e=(0,k.A)(c,this),t=this.createResult((0,k.A)(a,this),this.options);if((0,D.A)(u,this,(0,k.A)(a,this).state),(0,D.A)(d,this,this.options),void 0!==(0,k.A)(u,this).data&&(0,D.A)(f,this,(0,k.A)(a,this)),(0,H.f8)(t,e))return;(0,D.A)(c,this,t);(0,C.A)(x,this,Q).call(this,{listeners:(()=>{if(!e)return!0;const{notifyOnChangeProps:t}=this.options,s="function"===typeof t?t():t;if("all"===s||!s&&!(0,k.A)(y,this).size)return!0;const n=new Set(null!==s&&void 0!==s?s:(0,k.A)(y,this));return this.options.throwOnError&&n.add("error"),Object.keys((0,k.A)(c,this)).some(t=>{const s=t;return(0,k.A)(c,this)[s]!==e[s]&&n.has(s)})})()})}onQueryUpdate(){this.updateResult(),this.hasListeners()&&(0,C.A)(x,this,T).call(this)}});function O(e){(0,C.A)(x,this,q).call(this);let t=(0,k.A)(a,this).fetch(this.options,e);return null!==e&&void 0!==e&&e.throwOnError||(t=t.catch(H.lQ)),t}function I(){(0,C.A)(x,this,P).call(this);const e=(0,H.d2)(this.options.staleTime,(0,k.A)(a,this));if(H.S$||(0,k.A)(c,this).isStale||!(0,H.gn)(e))return;const t=(0,H.j3)((0,k.A)(c,this).dataUpdatedAt,e)+1;(0,D.A)(g,this,F.zs.setTimeout(()=>{(0,k.A)(c,this).isStale||this.updateResult()},t))}function L(){var e;return null!==(e="function"===typeof this.options.refetchInterval?this.options.refetchInterval((0,k.A)(a,this)):this.options.refetchInterval)&&void 0!==e&&e}function _(e){(0,C.A)(x,this,W).call(this),(0,D.A)(b,this,e),!H.S$&&!1!==(0,H.Eh)(this.options.enabled,(0,k.A)(a,this))&&(0,H.gn)((0,k.A)(b,this))&&0!==(0,k.A)(b,this)&&(0,D.A)(A,this,F.zs.setInterval(()=>{(this.options.refetchIntervalInBackground||S.m.isFocused())&&(0,C.A)(x,this,O).call(this)},(0,k.A)(b,this)))}function T(){(0,C.A)(x,this,I).call(this),(0,C.A)(x,this,_).call(this,(0,C.A)(x,this,L).call(this))}function P(){(0,k.A)(g,this)&&(F.zs.clearTimeout((0,k.A)(g,this)),(0,D.A)(g,this,void 0))}function W(){(0,k.A)(A,this)&&(F.zs.clearInterval((0,k.A)(A,this)),(0,D.A)(A,this,void 0))}function q(){const e=(0,k.A)(o,this).getQueryCache().build((0,k.A)(o,this),this.options);if(e===(0,k.A)(a,this))return;const t=(0,k.A)(a,this);(0,D.A)(a,this,e),(0,D.A)(l,this,e.state),this.hasListeners()&&(null===t||void 0===t||t.removeObserver(this),e.addObserver(this))}function Q(e){R.jG.batch(()=>{e.listeners&&this.listeners.forEach(e=>{e((0,k.A)(c,this))}),(0,k.A)(o,this).getQueryCache().notify({query:(0,k.A)(a,this),type:"observerResultsUpdated"})})}function B(e,t){return function(e,t){return!1!==(0,H.Eh)(t.enabled,e)&&void 0===e.state.data&&!("error"===e.state.status&&!1===t.retryOnMount)}(e,t)||void 0!==e.state.data&&z(e,t,t.refetchOnMount)}function z(e,t,s){if(!1!==(0,H.Eh)(t.enabled,e)&&"static"!==(0,H.d2)(t.staleTime,e)){const n="function"===typeof s?s(e):s;return"always"===n||!1!==n&&G(e,t)}return!1}function Y(e,t,s,n){return(e!==t||!1===(0,H.Eh)(n.enabled,e))&&(!s.suspense||"error"!==e.state.status)&&G(e,s)}function G(e,t){return!1!==(0,H.Eh)(t.enabled,e)&&e.isStaleByTime((0,H.d2)(t.staleTime,e))}var $=s(248),K=s(579);function J(){let e=!1;return{clearReset:()=>{e=!1},reset:()=>{e=!0},isReset:()=>e}}var V=r.createContext(J()),X=r.createContext(!1),Z=(X.Provider,(e,t,s)=>t.fetchOptimistic(e).catch(()=>{s.clearReset()}));function ee(e,t,s){var n,i,o,a;const l=r.useContext(X),c=r.useContext(V),u=(0,$.jE)(s),d=u.defaultQueryOptions(e);null===(n=u.getDefaultOptions().queries)||void 0===n||null===(i=n._experimental_beforeQuery)||void 0===i||i.call(n,d),d._optimisticResults=l?"isRestoring":"optimistic",(e=>{if(e.suspense){const t=1e3,s=e=>"static"===e?e:Math.max(null!==e&&void 0!==e?e:t,t),n=e.staleTime;e.staleTime="function"===typeof n?function(){return s(n(...arguments))}:s(n),"number"===typeof e.gcTime&&(e.gcTime=Math.max(e.gcTime,t))}})(d),((e,t)=>{(e.suspense||e.throwOnError||e.experimental_prefetchInRender)&&(t.isReset()||(e.retryOnMount=!1))})(d,c),(e=>{r.useEffect(()=>{e.clearReset()},[e])})(c);const h=!u.getQueryCache().get(d.queryHash),[p]=r.useState(()=>new t(u,d)),v=p.getOptimisticResult(d),m=!l&&!1!==e.subscribed;if(r.useSyncExternalStore(r.useCallback(e=>{const t=m?p.subscribe(R.jG.batchCalls(e)):H.lQ;return p.updateResult(),t},[p,m]),()=>p.getCurrentResult(),()=>p.getCurrentResult()),r.useEffect(()=>{p.setOptions(d)},[d,p]),((e,t)=>(null===e||void 0===e?void 0:e.suspense)&&t.isPending)(d,v))throw Z(d,p,c);if((e=>{let{result:t,errorResetBoundary:s,throwOnError:n,query:r,suspense:i}=e;return t.isError&&!s.isReset()&&!t.isFetching&&r&&(i&&void 0===t.data||(0,H.GU)(n,[t.error,r]))})({result:v,errorResetBoundary:c,throwOnError:d.throwOnError,query:u.getQueryCache().get(d.queryHash),suspense:d.suspense}))throw v.error;if(null===(o=u.getDefaultOptions().queries)||void 0===o||null===(a=o._experimental_afterQuery)||void 0===a||a.call(o,d,v),d.experimental_prefetchInRender&&!H.S$&&((e,t)=>e.isLoading&&e.isFetching&&!t)(v,l)){var f;const e=h?Z(d,p,c):null===(f=u.getQueryCache().get(d.queryHash))||void 0===f?void 0:f.promise;null===e||void 0===e||e.catch(H.lQ).finally(()=>{p.updateResult()})}return d.notifyOnChangeProps?v:p.trackResult(v)}function te(e,t){return ee(e,U,t)}var se=s(179);function ne(){const e=(0,$.jE)(),t="undefined"!==typeof window?localStorage.getItem("token"):null,{data:s,isLoading:n,error:r}=te({queryKey:["me",t],queryFn:async()=>{if(!t)return null;const{data:e}=await i.A.get("/user/me");return e},enabled:!!t}),o=function(){try{const e=localStorage.getItem("token");if(!e)return null;const[,t]=e.split(".");return JSON.parse(atob(t.replace(/-/g,"+").replace(/_/g,"/")))}catch(e){return null}}();return{user:s,role:(null===o||void 0===o?void 0:o.role)||localStorage.getItem("role")||(null===s||void 0===s?void 0:s.role),token:t,isLoading:n,error:r,refetch:()=>e.invalidateQueries({queryKey:["me"]})}}var re=s(912);const ie=["Lundi","Mardi","Mercredi","Jeudi","Vendredi","Samedi","Dimanche"];function oe(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Date;const t=new Date(e);t.setHours(0,0,0,0);const s=t.getDay(),n=0===s?-6:1-s;return t.setDate(t.getDate()+n),t}function ae(e,t){const s=new Date(e);return s.setDate(s.getDate()+t),s.setHours(0,0,0,0),s}function le(e,t){return e.getFullYear()===t.getFullYear()&&e.getMonth()===t.getMonth()&&e.getDate()===t.getDate()}function ce(e){const t=e.getFullYear(),s=String(e.getMonth()+1).padStart(2,"0"),n=String(e.getDate()).padStart(2,"0");return"".concat(t,"-").concat(s,"-").concat(n)}function ue(e){var t;if(!e)return 0;if("string"===typeof e&&e.includes(":"))return null!==(t=(0,se.Rl)(e))&&void 0!==t?t:0;if(e instanceof Date)return 60*e.getHours()+e.getMinutes();const s=Number(e);return Number.isNaN(s)?0:s}const de=[{bg:"#DBEAFE",border:"#93C5FD"},{bg:"#FDE68A",border:"#F59E0B"},{bg:"#FBCFE8",border:"#F472B6"},{bg:"#BFDBFE",border:"#60A5FA"},{bg:"#C7F9CC",border:"#34D399"},{bg:"#FECACA",border:"#F87171"},{bg:"#E9D5FF",border:"#C084FC"}];function he(e){const t=function(e){if(!e)return null;const t=e.replace("#",""),s=3===t.length?t.split("").map(e=>e+e).join(""):t,n=parseInt(s.slice(0,2),16),r=parseInt(s.slice(2,4),16),i=parseInt(s.slice(4,6),16);return[n,r,i].some(e=>Number.isNaN(e))?null:{r:n,g:r,b:i}}(e);if(!t)return{text:"#111",muted:"rgba(17,17,17,0.7)",shadow:"none"};var s,n,r;return(s=t.r,n=t.g,r=t.b,(299*s+587*n+114*r)/1e3)>=186?{text:"#111",muted:"rgba(17,17,17,0.6)",shadow:"0 1px 0 rgba(255,255,255,0.5)"}:{text:"#fff",muted:"rgba(255,255,255,0.75)",shadow:"0 1px 0 rgba(0,0,0,0.4)"}}function pe(e,t,s,r,i){const o=ie.reduce((e,t)=>(0,n.A)((0,n.A)({},e),{},{[t]:[]}),{});e.forEach(e=>{const t=function(e,t){if(e.day&&ie.includes(e.day))return e.day;const s=e.date?new Date(e.date):e.startDate?new Date(e.startDate):null;if(!s)return null;s.setHours(0,0,0,0);for(let n=0;n<7;n++)if(le(s,ae(t,n)))return ie[n];return null}(e,i||oe());t&&o[t].push(e)});const a={};return ie.forEach(e=>{const i=o[e].map(e=>{const r=e.startHour?ue(e.startHour):e.start?ue(e.start):t,i=e.endHour?ue(e.endHour):e.end?ue(e.end):s,o=Math.max(r,t),a=Math.min(i,s);return(0,n.A)((0,n.A)({},e),{},{start:o,end:a})}).filter(e=>e.end>e.start).sort((e,t)=>e.start-t.start||e.end-t.end);let l=[],c=-1;const u=new Set,d=new Map,h=[];i.forEach(e=>{var s;s=e.start,l=l.filter(e=>!(e.end<=s)||(u.delete(e._col),!1)),0===l.length&&(u.clear(),c+=1);let i=0;for(;u.has(i);)i+=1;u.add(i),l.push((0,n.A)((0,n.A)({},e),{},{_col:i}));const o=Math.max(i+1,d.get(c)||0);d.set(c,o);const a=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=0;for(let s=0;s<e.length;s++)t=31*t+e.charCodeAt(s)>>>0;return de[t%de.length]}(e.title||e.subject||""),p=e.color||a.bg,v=e.borderColor||a.border,{text:m,muted:f,shadow:g}=he(p);h.push((0,n.A)((0,n.A)({},e),{},{clusterId:c,col:i,top:(e.start-t)*r,height:(e.end-e.start)*r,style:{backgroundColor:p,borderColor:v,textColor:m,mutedColor:f,textShadow:g}}))});const p=Object.fromEntries(d.entries());h.forEach(e=>{const t=p[e.clusterId]||1;e.width=100/t,e.left=100*e.col/t}),a[e]=h}),a}function ve(e){return new Date(e.getFullYear(),e.getMonth(),1)}function me(e,t){const s=new Date(e);return s.setMonth(s.getMonth()+t),s.setDate(1),s.setHours(0,0,0,0),s}function fe(e){if(!e)return null;const t=e instanceof Date?new Date(e.getTime()):new Date(e);return Number.isNaN(t.getTime())?null:(t.setHours(0,0,0,0),t)}function ge(e){const t=fe(e.date||e.startDate||e.start),s=fe(e.endDate||e.end)||t;return t?{start:t,end:s}:null}function Ae(e,t){const s=[],n=new Date(e);for(;n<=t;)s.push(new Date(n)),n.setDate(n.getDate()+1);return s}function be(e){var t;return e?/^https?:\/\//i.test(e)?e:e.startsWith("/")?((null===i.A||void 0===i.A||null===(t=i.A.defaults)||void 0===t?void 0:t.baseURL)||"").replace(/\/$/,"")+e:e:""}function ye(e){const t=ae(e,6),s=e=>e.toLocaleDateString("fr-FR",{day:"2-digit",month:"short"});return"".concat(s(e)," \u2013 ").concat(s(t))}const xe=function(){var e,t,s,o,a,l,c,u;const{settings:d}=(0,se.t0)(),{user:h,token:p,refetch:v}=ne(),[m,f]=(0,r.useState)("week"),[g,A]=(0,r.useState)(()=>oe()),[b,y]=(0,r.useState)(()=>ve(new Date)),[x,w]=(0,r.useState)([]),[j,C]=(0,r.useState)(""),[k,D]=(0,r.useState)(1),S="admin"===localStorage.getItem("role"),[R,N]=(0,r.useState)([]),[E,M]=(0,r.useState)({title:"",date:ce(new Date),endDate:"",startHour:"",endHour:"",location:"",color:"#93C5FD",imageUrl:"",description:"",clubId:""}),H=null!==(e=(0,se.Rl)(null===d||void 0===d||null===(t=d.schedule)||void 0===t?void 0:t.timeStart))&&void 0!==e?e:480,F=null!==(s=(0,se.Rl)(null===d||void 0===d||null===(o=d.schedule)||void 0===o?void 0:o.timeEnd))&&void 0!==s?s:1140,U=null!==(a=null===d||void 0===d||null===(l=d.ui)||void 0===l?void 0:l.pxPerMin)&&void 0!==a?a:1.2,[O,I]=(0,r.useState)(1),L=(0,r.useRef)(null),_=(0,r.useRef)(!1),T=(0,r.useRef)({x:0,y:0,left:0,top:0}),P=U*O,W="week"===m?ce(g):void 0,q="week"===m?ce(ae(g,6)):void 0,[Q,B]=(0,r.useState)(""),[z,Y]=(0,r.useState)([]),[G,$]=(0,r.useState)([]);(0,r.useEffect)(()=>{h?(Y(h.pinnedEvents||[]),$(h.subscribedEvents||[])):(Y([]),$([]))},[h]);const{data:J,isLoading:V}=te({queryKey:["events",{page:k,limit:200,from:W,to:q,club:Q}],queryFn:async()=>{const e=new URLSearchParams;e.set("page",k),e.set("limit",200),W&&e.set("from",W),q&&e.set("to",q),Q&&e.set("clubId",Q);const{data:t}=await i.A.get("/events?"+e.toString());return Array.isArray(t)?{events:t,total:t.length,page:1,pages:1}:t},staleTime:12e4});(0,r.useEffect)(()=>{null!==J&&void 0!==J&&J.events&&w(J.events)},[J]);const X=r.useCallback(async()=>{if(S)try{const{data:e}=await i.A.get("/clubs");N(Array.isArray(e)?e:[])}catch(e){}},[S]);(0,r.useEffect)(()=>{X()},[X]);const Z=(0,r.useMemo)(()=>pe(x,H,F,P,g),[x,H,F,P,g]),ee=(0,r.useMemo)(()=>Array.from({length:7},(e,t)=>ae(g,t)),[g]),ue=new Date,de=60*ue.getHours()+ue.getMinutes(),he=(null===(c=null===d||void 0===d||null===(u=d.schedule)||void 0===u?void 0:u.showNowLine)||void 0===c||c)&&de>=H&&de<=F,fe=(0,r.useMemo)(()=>ve(b),[b]),xe=(0,r.useMemo)(()=>function(e){const t=new Date(e);t.setHours(0,0,0,0);const s=t.getDay(),n=0===s?-6:1-s;return t.setDate(t.getDate()+n),t}(fe),[fe]),we=(0,r.useMemo)(()=>Array.from({length:42},(e,t)=>{const s=new Date(xe);return s.setDate(s.getDate()+t),s}),[xe]),je=(0,r.useMemo)(()=>{const e=new Map;for(const t of x){const s=ge(t);if(s)for(const n of Ae(s.start,s.end)){const s=ce(n);e.has(s)||e.set(s,[]),e.get(s).push(t)}}for(const[,t]of e)t.sort((e,t)=>(e.startHour?(0,se.Rl)(e.startHour):0)-(t.startHour?(0,se.Rl)(t.startHour):0));return e},[x]),Ce=e=>{if(!_.current)return;const t=L.current;if(!t)return;const s=e.clientX-T.current.x,n=e.clientY-T.current.y;t.scrollLeft=T.current.left-s,t.scrollTop=T.current.top-n},ke=()=>{_.current=!1;const e=L.current;e&&(e.style.cursor="grab"),window.removeEventListener("mousemove",Ce),window.removeEventListener("mouseup",ke)},De=e=>M(t=>(0,n.A)((0,n.A)({},t),{},{[e.target.name]:e.target.value})),Se=e=>z.includes(e)&&G.includes(e),Re=async e=>{if(!p)return;const t=Se(e);try{t?(Y(t=>t.filter(t=>t!==e)),$(t=>t.filter(t=>t!==e)),await Promise.all([i.A.post("/events/".concat(e,"/unpin")),i.A.post("/events/".concat(e,"/unsubscribe"))])):(Y(t=>t.includes(e)?t:t.concat(e)),$(t=>t.includes(e)?t:t.concat(e)),await Promise.all([i.A.post("/events/".concat(e,"/pin")),i.A.post("/events/".concat(e,"/subscribe"))]))}catch(s){v()}};return(0,K.jsxs)("div",{className:"events-wrap",style:(0,n.A)({},(0,se.O3)(d)),children:[(0,K.jsxs)("div",{className:"events-head",style:{display:"flex",alignItems:"center",gap:8,justifyContent:"space-between",marginBottom:8},children:[(0,K.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,K.jsx)("h2",{style:{margin:0},children:"Mes \xe9v\xe9nements"}),"week"===m?(0,K.jsx)("div",{style:{color:"var(--muted)"},children:ye(g)}):(0,K.jsx)("div",{style:{color:"var(--muted)"},children:fe.toLocaleDateString("fr-FR",{month:"long",year:"numeric"})})]}),(0,K.jsxs)("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[(0,K.jsxs)("div",{className:"view-switch",role:"tablist","aria-label":"Vue calendrier",children:[(0,K.jsx)("button",{className:"week-btn",onClick:()=>f("week"),"aria-pressed":"week"===m,children:"Semaine"}),(0,K.jsx)("button",{className:"week-btn",onClick:()=>f("month"),"aria-pressed":"month"===m,children:"Mois"})]}),(0,K.jsx)("button",{className:"week-btn",onClick:()=>{"week"===m?A(ae(g,-7)):y(me(b,-1))},children:"\u27f5 Pr\xe9c\xe9dent"}),(0,K.jsx)("button",{className:"week-btn",onClick:()=>{"week"===m?A(ae(g,7)):y(me(b,1))},children:"Suivant \u27f6"})]})]}),j&&(0,K.jsx)("div",{style:{color:"crimson",marginBottom:12},children:j}),V&&(0,K.jsx)("div",{style:{color:"var(--muted)",marginBottom:12},children:"Chargement\u2026"}),(0,K.jsx)("div",{style:{display:"flex",gap:8,flexWrap:"wrap",marginBottom:12},children:(0,K.jsxs)("select",{value:Q,onChange:e=>{D(1),B(e.target.value)},className:"week-btn",style:{padding:4},children:[(0,K.jsx)("option",{value:"",children:"Tous les clubs"}),R.map(e=>(0,K.jsx)("option",{value:e._id,children:e.clubName},e._id))]})}),!V&&J&&J.pages>1&&(0,K.jsxs)("div",{style:{display:"flex",gap:8,marginBottom:12},children:[(0,K.jsx)("button",{className:"week-btn",disabled:k<=1,onClick:()=>D(e=>e-1),children:"Page -"}),(0,K.jsxs)("div",{children:["Page ",J.page," / ",J.pages]}),(0,K.jsx)("button",{className:"week-btn",disabled:k>=J.pages,onClick:()=>D(e=>e+1),children:"Page +"})]}),S&&(0,K.jsxs)("form",{onSubmit:async e=>{e.preventDefault(),C("");try{if(!E.title||!E.date)return C("Titre et date requis");if(E.startHour&&E.endHour&&!(E.startHour<E.endHour))return C("L'heure de d\xe9but doit \xeatre avant l'heure de fin");const e={title:E.title.trim(),date:E.date,endDate:E.endDate||void 0,startHour:E.startHour||void 0,endHour:E.endHour||void 0,location:E.location||void 0,description:E.description||void 0,imageUrl:E.imageUrl||void 0,color:E.imageUrl?void 0:E.color||void 0,clubId:E.clubId||void 0},{data:t}=await i.A.post("/events",e);M(e=>(0,n.A)((0,n.A)({},e),{},{title:"",startHour:"",endHour:"",location:"",description:"",color:"#93C5FD",imageUrl:""})),w(e=>[t,...e])}catch(r){var t,s;C((null===(t=r.response)||void 0===t||null===(s=t.data)||void 0===s?void 0:s.error)||"Erreur cr\xe9ation \xe9v\xe9nement (r\xe9serv\xe9 admin)")}},style:{display:"grid",gridTemplateColumns:"repeat(8, minmax(140px, 1fr))",gap:8,marginBottom:12},children:[(0,K.jsxs)("label",{children:["Titre",(0,K.jsx)("input",{name:"title",value:E.title,onChange:De,required:!0})]}),(0,K.jsxs)("label",{children:["Date",(0,K.jsx)("input",{name:"date",type:"date",value:E.date,onChange:De,required:!0})]}),(0,K.jsxs)("label",{children:["Fin (facultatif)",(0,K.jsx)("input",{name:"endDate",type:"date",value:E.endDate,onChange:De})]}),(0,K.jsxs)("label",{children:["D\xe9but",(0,K.jsx)("input",{name:"startHour",type:"time",value:E.startHour,onChange:De})]}),(0,K.jsxs)("label",{children:["Fin",(0,K.jsx)("input",{name:"endHour",type:"time",value:E.endHour,onChange:De})]}),(0,K.jsxs)("label",{children:["Lieu",(0,K.jsx)("input",{name:"location",value:E.location,onChange:De})]}),(0,K.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:6},children:[(0,K.jsx)("label",{children:"Image (remplace la couleur si d\xe9finie)"}),(0,K.jsx)(re.A,{onUploaded:e=>M(t=>(0,n.A)((0,n.A)({},t),{},{imageUrl:"approved"===e.status?e.absoluteUrl||be(e.url):""}))}),(0,K.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,K.jsx)("small",{style:{color:"var(--muted)"},children:"ou couleur"}),(0,K.jsx)("input",{name:"color",type:"color",value:E.color,onChange:De})]}),E.imageUrl&&(0,K.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,K.jsx)("img",{loading:"lazy",src:E.imageUrl,alt:"aper\xe7u",style:{height:32,borderRadius:4,border:"1px solid var(--line)"}}),(0,K.jsx)("button",{type:"button",className:"week-btn",onClick:()=>M(e=>(0,n.A)((0,n.A)({},e),{},{imageUrl:""})),children:"Retirer l\u2019image"})]})]}),(0,K.jsxs)("label",{children:["Club (optionnel)",(0,K.jsxs)("select",{name:"clubId",value:E.clubId,onChange:De,children:[(0,K.jsx)("option",{value:"",children:"\u2014 Aucun \u2014"}),R.map(e=>(0,K.jsx)("option",{value:e._id,children:e.clubName},e._id))]})]}),(0,K.jsxs)("label",{style:{gridColumn:"1 / -1"},children:["Description",(0,K.jsx)("input",{name:"description",value:E.description,onChange:De})]}),(0,K.jsx)("div",{style:{gridColumn:"1 / -1"},children:(0,K.jsx)("button",{type:"submit",className:"week-btn",children:"Cr\xe9er l\u2019\xe9v\xe9nement (admin)"})})]}),"week"===m?(0,K.jsx)("div",{className:"events-grid-scroll",ref:L,onWheel:e=>{if("week"!==m)return;e.preventDefault();const t=L.current;if(!t)return;const s=t.getBoundingClientRect(),n=e.clientY-s.top+t.scrollTop,r=O,i=(o=r*(e.deltaY<0?1.1:.9),a=.6,l=3,Math.max(a,Math.min(l,o)));var o,a,l;if(i===r)return;const c=n*(i/r)-(e.clientY-s.top);I(i),requestAnimationFrame(()=>{t.scrollTop=c})},onMouseDown:e=>{if("week"!==m)return;const t=L.current;t&&(_.current=!0,T.current={x:e.clientX,y:e.clientY,left:t.scrollLeft,top:t.scrollTop},t.style.cursor="grabbing",window.addEventListener("mousemove",Ce),window.addEventListener("mouseup",ke))},style:{cursor:"grab","--px-per-min":P},children:(0,K.jsxs)("div",{className:"events-grid",children:[(0,K.jsx)("div",{className:"events-hours-col","aria-hidden":"true",children:Array.from({length:F-H},(e,t)=>t).filter(e=>e%60===0).map(e=>{const t=Math.floor((H+e)/60),s=String((H+e)%60).padStart(2,"0");return(0,K.jsxs)("div",{className:"events-hour-label",children:[String(t).padStart(2,"0"),":",s]},e)})}),ie.map((e,t)=>{var s;const n=ee[t];return(0,K.jsxs)("div",{className:"events-day-col",children:[(0,K.jsx)("div",{className:"events-day-header",children:e}),(0,K.jsxs)("div",{className:"events-day-content",children:[he&&le(n,ue)&&(0,K.jsx)("div",{className:"events-now-line",style:{top:(de-H)*P}}),null===(s=Z[e])||void 0===s?void 0:s.map((t,s)=>(0,K.jsxs)("div",{className:"events-slot",style:{"--slot-top":"".concat(t.top,"px"),"--slot-height":"".concat(t.height,"px"),"--slot-left":"calc(".concat(t.left,"% + var(--col-pad))"),"--slot-width":"calc(".concat(t.width,"% - (var(--col-pad) * 2))"),backgroundColor:t.imageUrl?"transparent":t.style.backgroundColor,borderColor:t.style.borderColor,color:t.style.textColor,textShadow:t.style.textShadow,backgroundImage:t.imageUrl?"linear-gradient(0deg, rgba(0,0,0,0.35), rgba(0,0,0,0.35)), url(".concat(be(t.imageUrl),")"):void 0,backgroundSize:t.imageUrl?"cover":void 0,backgroundPosition:t.imageUrl?"center":void 0},children:[(0,K.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:8},children:[(0,K.jsx)("div",{className:"events-slot-title",children:t.title||t.subject||"\xc9v\xe9nement"}),(0,K.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:4},children:[p&&(0,K.jsx)("button",{onClick:()=>Re(t._id),className:"week-btn",style:{padding:"2px 6px",fontSize:12},title:Se(t._id)?"Ne plus suivre (retire de mon EDT & notifications)":"Suivre (ajoute \xe0 mon EDT & notifications)",children:Se(t._id)?"Suivi \u2713":"Suivre"}),S&&(0,K.jsx)("button",{onClick:()=>(async e=>{if(S)try{await i.A.delete("/events/".concat(e)),w(t=>t.filter(t=>t._id!==e))}catch(n){var t,s;C((null===(t=n.response)||void 0===t||null===(s=t.data)||void 0===s?void 0:s.error)||"Erreur suppression")}})(t._id),style:{background:"transparent",border:"none",color:t.style.mutedColor,cursor:"pointer"},title:"Supprimer (admin)",children:"\ud83d\uddd1\ufe0f"})]})]}),(0,K.jsxs)("div",{className:"events-slot-time",style:{color:t.style.mutedColor},children:[(t.startHour||"").toString(),t.endHour?" \u2013 ".concat(t.endHour):""]}),t.location&&(0,K.jsxs)("div",{className:"events-slot-loc",style:{color:t.style.mutedColor},children:["@ ",t.location]})]},(t._id||t.id||s)+"-"+e))]})]},e)})]})}):(0,K.jsx)("div",{className:"events-month-scroll",children:(0,K.jsxs)("div",{className:"events-month-grid",children:[(0,K.jsx)("div",{className:"events-month-weekdays",children:["Lun","Mar","Mer","Jeu","Ven","Sam","Dim"].map(e=>(0,K.jsx)("div",{className:"events-month-weekday",children:e},e))}),we.map(e=>{const t=ce(e),s=e.getMonth()!==fe.getMonth(),n=ce(e)===ce(new Date),r=je.get(t)||[],i=r.slice(0,5),o=r.length-i.length;return(0,K.jsxs)("div",{className:"events-month-cell".concat(s?" is-other-month":"").concat(n?" is-today":""),children:[(0,K.jsx)("div",{className:"events-month-cell-head",children:(0,K.jsx)("span",{className:"events-month-daynum",children:e.getDate()})}),(0,K.jsxs)("div",{className:"events-month-items",children:[i.map((e,s)=>{var n;const r=e.color||(null===(n=e.style)||void 0===n?void 0:n.backgroundColor)||"#93C5FD";return(0,K.jsxs)("div",{className:"events-month-item",title:e.title||e.subject||"",style:{display:"flex",alignItems:"center",gap:4},children:[e.imageUrl?(0,K.jsx)("span",{style:{width:16,height:16,borderRadius:3,backgroundImage:"url(".concat(be(e.imageUrl),")"),backgroundSize:"cover",backgroundPosition:"center",flex:"0 0 16px"}}):(0,K.jsx)("span",{className:"events-month-dot",style:{backgroundColor:r}}),(0,K.jsxs)("span",{style:{flex:1,overflow:"hidden",textOverflow:"ellipsis"},children:[e.title||e.subject||"\xc9v\xe9nement",e.startHour&&e.endHour?" \u2022 ".concat(e.startHour,"\u2013").concat(e.endHour):""]}),p&&(0,K.jsx)("button",{onClick:()=>Re(e._id),style:{background:"transparent",border:"none",cursor:"pointer",color:Se(e._id)?r:"var(--muted)",fontSize:14,lineHeight:1},title:Se(e._id)?"Ne plus suivre":"Suivre",children:Se(e._id)?"\u2605":"\u2606"})]},(e._id||e.id||s)+"-"+t)}),o>0&&(0,K.jsxs)("div",{className:"events-month-more",children:["+",o," autres\u2026"]})]})]},t)})]})})]})}},912:(e,t,s)=>{s.d(t,{A:()=>a});var n=s(555),r=s(43),i=s(674),o=s(579);function a(e){let{onUploaded:t,showPreview:s=!0,previewSize:a=64}=e;const[l,c]=(0,r.useState)(null),[u,d]=(0,r.useState)(""),[h,p]=(0,r.useState)(""),v=(0,r.useRef)(null);return(0,o.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:8},children:[(0,o.jsx)("input",{type:"file",accept:"image/png,image/jpeg,image/webp",ref:v,onChange:e=>{var t;const s=null===(t=e.target.files)||void 0===t?void 0:t[0];s&&(s.size>2097152?d("> 2MB refus\xe9"):(c(s),p(URL.createObjectURL(s)),d("")))}}),s&&h&&(0,o.jsx)("img",{src:h,alt:"pr\xe9visualisation",style:{width:a,height:a,objectFit:"cover",border:"1px solid var(--line)",borderRadius:6}}),(0,o.jsx)("button",{className:"week-btn",type:"button",onClick:async e=>{var s;if(null===e||void 0===e||null===(s=e.preventDefault)||void 0===s||s.call(e),!l)return;d("Envoi...");const r=new FormData;r.append("file",l);try{var o,a;const{data:e}=await i.A.post("/media/image",r,{headers:{"Content-Type":"multipart/form-data"}});d("approved"===e.status?"OK":"En attente mod\xe9ration"),c(null),v.current&&(v.current.value="");const s=(null===i.A||void 0===i.A||null===(o=i.A.defaults)||void 0===o||null===(a=o.baseURL)||void 0===a?void 0:a.replace(/\/$/,""))||"",l=null!==e&&void 0!==e&&e.url?e.url.startsWith("/")?s+e.url:e.url:"";p("approved"===e.status&&l?l:""),t&&t((0,n.A)((0,n.A)({},e),{},{absoluteUrl:l}))}catch(m){var u,h;const e=(null===(u=m.response)||void 0===u||null===(h=u.data)||void 0===h?void 0:h.error)||"Erreur upload";d(e)}},disabled:!l,children:"Uploader l\u2019image"}),u&&(0,o.jsx)("small",{style:{color:"var(--muted)"},children:u})]})}}}]);
//# sourceMappingURL=729.3c41c08a.chunk.js.map