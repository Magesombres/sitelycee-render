{"version":3,"file":"static/js/658.cc70daf3.chunk.js","mappings":"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","sources":["components/AccountPanel.js"],"sourcesContent":["import React, { useEffect, useState, useMemo } from 'react';\r\nimport API from '../api';\r\n\r\nfunction AccountPanel() {\r\n  const [profile, setProfile] = useState({ username: '', role: '' });\r\n  const [pwdForm, setPwdForm] = useState({ currentPassword: '', newPassword: '', confirmNewPassword: '' });\r\n  const [uname, setUname] = useState('');\r\n  const [msg, setMsg] = useState('');\r\n  const [err, setErr] = useState('');\r\n\r\n  const isAdmin = useMemo(() => localStorage.getItem('role') === 'admin', []);\r\n\r\n  useEffect(() => {\r\n    (async () => {\r\n      try {\r\n        const { data } = await API.get('/user/me');\r\n        setProfile(data);\r\n        setUname(data.username);\r\n      } catch (e) {\r\n        setErr(e.response?.data?.error || 'Erreur profil');\r\n      }\r\n    })();\r\n  }, []);\r\n\r\n  const complexityError = useMemo(() => {\r\n    const pw = pwdForm.newPassword || '';\r\n    if (!pw) return '';\r\n    if (pw.length < 8) return 'Au moins 8 caractères';\r\n    if (!/[A-Z]/.test(pw)) return 'Au moins une majuscule';\r\n    if (!/[a-z]/.test(pw)) return 'Au moins une minuscule';\r\n    if (!/[0-9]/.test(pw)) return 'Au moins un chiffre';\r\n    if (!/[^A-Za-z0-9]/.test(pw)) return 'Au moins un caractère spécial';\r\n    return '';\r\n  }, [pwdForm.newPassword]);\r\n\r\n  const savePassword = async (e) => {\r\n    e.preventDefault();\r\n    setMsg(''); setErr('');\r\n    try {\r\n      if (complexityError) return setErr(complexityError);\r\n      const { data } = await API.patch('/user/password', pwdForm);\r\n      setMsg(data.message || 'Mot de passe mis à jour');\r\n      setPwdForm({ currentPassword: '', newPassword: '', confirmNewPassword: '' });\r\n    } catch (e2) {\r\n      setErr(e2.response?.data?.error || 'Erreur mise à jour mot de passe');\r\n    }\r\n  };\r\n\r\n  const saveUsername = async (e) => {\r\n    e.preventDefault();\r\n    setMsg(''); setErr('');\r\n    try {\r\n      const { data } = await API.patch('/user/username', { username: uname.trim() });\r\n      // Le backend renvoie un nouveau token si le username change\r\n      if (data.token) {\r\n        localStorage.setItem('token', data.token);\r\n        localStorage.setItem('role', data.user?.role || '');\r\n      }\r\n      setProfile((p) => ({ ...p, username: data.user?.username || uname }));\r\n      setMsg(data.message || 'Nom d’utilisateur mis à jour');\r\n    } catch (e2) {\r\n      setErr(e2.response?.data?.error || 'Erreur mise à jour username');\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div style={{ maxWidth: 520, margin: '24px auto' }}>\r\n      <h2>Mon compte</h2>\r\n      {err && <div style={{ color: 'red', marginBottom: 12 }}>{err}</div>}\r\n      {msg && <div style={{ color: 'green', marginBottom: 12 }}>{msg}</div>}\r\n\r\n      <div style={{ marginBottom: 24 }}>\r\n        <div><b>Utilisateur:</b> {profile.username}</div>\r\n        <div><b>Rôle:</b> {profile.role}</div>\r\n      </div>\r\n\r\n      <form onSubmit={savePassword} style={{ marginBottom: 32 }}>\r\n        <h3>Changer le mot de passe</h3>\r\n        <input\r\n          type=\"password\"\r\n          placeholder=\"Mot de passe actuel\"\r\n          value={pwdForm.currentPassword}\r\n          onChange={(e) => setPwdForm(f => ({ ...f, currentPassword: e.target.value }))}\r\n          required\r\n          style={{ display: 'block', marginBottom: 8, width: '100%' }}\r\n        />\r\n        <input\r\n          type=\"password\"\r\n          placeholder=\"Nouveau mot de passe\"\r\n          value={pwdForm.newPassword}\r\n          onChange={(e) => setPwdForm(f => ({ ...f, newPassword: e.target.value }))}\r\n          required\r\n          style={{ display: 'block', marginBottom: 8, width: '100%' }}\r\n        />\r\n        <input\r\n          type=\"password\"\r\n          placeholder=\"Confirmez le mot de passe\"\r\n          value={pwdForm.confirmNewPassword}\r\n          onChange={(e) => setPwdForm(f => ({ ...f, confirmNewPassword: e.target.value }))}\r\n          required\r\n          style={{ display: 'block', marginBottom: 8, width: '100%' }}\r\n        />\r\n        {!err && complexityError && <div style={{ color: '#a66', marginBottom: 8 }}>{complexityError}</div>}\r\n        <button type=\"submit\" disabled={!!complexityError}>Mettre à jour le mot de passe</button>\r\n      </form>\r\n\r\n      {isAdmin && (\r\n        <form onSubmit={saveUsername}>\r\n          <h3>Changer mon nom d’utilisateur (admin)</h3>\r\n          <input\r\n            value={uname}\r\n            onChange={(e) => setUname(e.target.value)}\r\n            placeholder=\"Nouveau nom d’utilisateur\"\r\n            required\r\n            style={{ display: 'block', marginBottom: 8, width: '100%' }}\r\n          />\r\n          <button type=\"submit\">Mettre à jour le nom d’utilisateur</button>\r\n        </form>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default AccountPanel;"],"names":["profile","setProfile","useState","username","role","pwdForm","setPwdForm","currentPassword","newPassword","confirmNewPassword","uname","setUname","msg","setMsg","err","setErr","isAdmin","useMemo","localStorage","getItem","useEffect","data","API","get","e","_e$response","_e$response$data","response","error","complexityError","pw","length","test","_jsxs","style","maxWidth","margin","children","_jsx","color","marginBottom","onSubmit","async","preventDefault","patch","message","e2","_e2$response","_e2$response$data","type","placeholder","value","onChange","f","_objectSpread","target","required","display","width","disabled","trim","_data$user","token","setItem","user","p","_data$user2","_e2$response2","_e2$response2$data"],"sourceRoot":""}