"use strict";(self.webpackChunkclient=self.webpackChunkclient||[]).push([[736],{736:(e,t,a)=>{a.r(t),a.d(t,{default:()=>c});var i=a(555),r=a(43),n=a(924),l=a(674),s=a(912),o=a(579);function d(e){var t;return e?/^https?:\/\//i.test(e)?e:e.startsWith("/")?((null===l.A||void 0===l.A||null===(t=l.A.defaults)||void 0===t?void 0:t.baseURL)||"").replace(/\/$/,"")+e:e:""}const c=function(){const{id:e}=(0,n.g)(),t=(0,n.Zp)(),a=!!localStorage.getItem("token"),[c,u]=(0,r.useState)([]),[v,p]=(0,r.useState)(null),[m,h]=(0,r.useState)([]),[g,b]=(0,r.useState)(!1),[x,y]=(0,r.useState)([]),[j,A]=(0,r.useState)([]),[f,H]=(0,r.useState)({frequency:"",interval:1,until:"",byDay:[]}),[w,C]=(0,r.useState)([]),[S,k]=(0,r.useState)({clubName:"",day:"Lundi",startHour:"",endHour:"",location:"",description:""}),[N,D]=(0,r.useState)({title:"",date:(new Date).toISOString().slice(0,10),startHour:"",endHour:"",location:"",color:"#60A5FA",imageUrl:"",description:""}),[_,U]=(0,r.useState)({date:(new Date).toISOString().slice(0,10),startHour:"",endHour:"",subject:"",teacher:"",capacity:1,notes:""}),[L,q]=(0,r.useState)({day:"Lundi",startHour:"",endHour:"",location:"",notes:""}),[R,E]=(0,r.useState)(""),[I,F]=(0,r.useState)(""),[T,B]=(0,r.useState)(!0),[M,O]=(0,r.useState)(""),[W,J]=(0,r.useState)({title:"",date:"",startHour:"",endHour:"",location:"",description:"",imageUrl:"",color:"#60A5FA"}),K={Lundi:0,Mardi:1,Mercredi:2,Jeudi:3,Vendredi:4,Samedi:5,Dimanche:6},V=function(){try{const e=localStorage.getItem("token");if(!e)return null;const[,t]=e.split(".");return JSON.parse(atob(t.replace(/-/g,"+").replace(/_/g,"/")))}catch(e){return null}}(),Y=(null===V||void 0===V?void 0:V.id)||(null===V||void 0===V?void 0:V.userId)||(null===V||void 0===V?void 0:V._id)||null,z="admin"===(null===V||void 0===V?void 0:V.role),P=z||!!v&&String(v.user)===String(Y),$="aide"===((null===v||void 0===v?void 0:v.clubName)||(null===v||void 0===v?void 0:v.name)||"").trim().toLowerCase();(0,r.useEffect)(()=>{e?(async()=>{try{var t;try{var a,i;const e=await l.A.get("/user/me");y((null===(a=e.data)||void 0===a?void 0:a.subscribedEvents)||[]),A((null===(i=e.data)||void 0===i?void 0:i.pinnedEvents)||[])}catch(c){}const o=await l.A.get("/clubs/".concat(e));p(o.data),F((null===(t=o.data)||void 0===t?void 0:t.bgImageUrl)||"");const d=(await l.A.get("/events?clubId=".concat(e))).data;h(Array.isArray(d)?d:(null===d||void 0===d?void 0:d.events)||[]);try{var r,n,s;const t=await l.A.get("/user/me");b(((null===(r=t.data)||void 0===r?void 0:r.followingClubs)||[]).includes(String(e))),y((null===(n=t.data)||void 0===n?void 0:n.subscribedEvents)||[]),A((null===(s=t.data)||void 0===s?void 0:s.pinnedEvents)||[])}catch(u){}E("")}catch(v){var o,d;p(null),h([]),C([]),E((null===(o=v.response)||void 0===o||null===(d=o.data)||void 0===d?void 0:d.error)||"Erreur chargement club")}})():Q()},[e]),(0,r.useEffect)(()=>{if(!e||!v)return;"aide"===((null===v||void 0===v?void 0:v.clubName)||"").trim().toLowerCase()&&P?(async()=>{try{const{data:t}=await l.A.get("/clubs/".concat(e,"/requests"));C(Array.isArray(t)?t:[])}catch(t){C([])}})():C([])},[e,v,P]);const Q=async()=>{try{const e=await l.A.get("/clubs");u(e.data),E("")}catch(e){E("Erreur de chargement des clubs")}},Z=e=>k((0,i.A)((0,i.A)({},S),{},{[e.target.name]:e.target.value})),G=async t=>{if(t.preventDefault(),P)try{if(!N.title||!N.date)return void E("Titre et date requis");if(N.startHour&&N.endHour&&!(N.startHour<N.endHour))return void E("L'heure de d\xe9but doit \xeatre avant l'heure de fin");const t={title:N.title.trim(),date:N.date,startHour:N.startHour||void 0,endHour:N.endHour||void 0,location:N.location||void 0,imageUrl:N.imageUrl||void 0,color:N.imageUrl?void 0:N.color||void 0,description:N.description||void 0,recurrence:f.frequency?{frequency:f.frequency.toUpperCase(),interval:Number(f.interval)||1,until:f.until||void 0,byDay:f.byDay}:void 0},{data:a}=await l.A.post("/events/club/".concat(e),t);h(e=>[a,...e]),E(""),D({title:"",date:(new Date).toISOString().slice(0,10),startHour:"",endHour:"",location:"",color:"#60A5FA",imageUrl:"",description:""}),H({frequency:"",interval:1,until:"",byDay:[]})}catch(r){var a,i;E((null===(a=r.response)||void 0===a||null===(i=a.data)||void 0===i?void 0:i.error)||"Erreur cr\xe9ation \xe9v\xe9nement du club (admin)")}},X=async t=>{t.preventDefault();try{if(!_.date||!_.startHour||!_.endHour||!_.teacher||!_.subject)return;if(!(_.startHour<_.endHour))return;const{data:t}=await l.A.post("/clubs/".concat(e,"/availability"),{date:_.date,startHour:_.startHour,endHour:_.endHour,subject:_.subject.trim(),teacher:_.teacher.trim(),capacity:Number(_.capacity)||1,notes:_.notes||void 0});p(t),U({date:(new Date).toISOString().slice(0,10),startHour:"",endHour:"",subject:"",teacher:"",capacity:1,notes:""})}catch(a){}},ee=()=>{O("")},te=async()=>{try{const e={title:W.title.trim(),date:W.date,startHour:W.startHour||void 0,endHour:W.endHour||void 0,location:W.location||void 0,description:W.description||void 0,imageUrl:W.imageUrl||void 0,color:W.imageUrl?void 0:W.color||void 0},{data:t}=await l.A.patch("/events/".concat(M),e);h(e=>e.map(e=>e._id===M?t:e)),O("")}catch(a){var e,t;alert((null===(e=a.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.error)||"Erreur mise \xe0 jour \xe9v\xe9nement")}},ae=async(t,a)=>{try{await l.A.patch("/clubs/".concat(e,"/requests/").concat(t),{action:a});const{data:i}=await l.A.get("/clubs/".concat(e,"/requests"));C(Array.isArray(i)?i:[])}catch(i){}},ie=async t=>{t.preventDefault();try{if(!L.startHour||!L.endHour)return;if(!(L.startHour<L.endHour))return;const{data:t}=await l.A.post("/clubs/".concat(e,"/weekly-slot"),{day:L.day,startHour:L.startHour,endHour:L.endHour,location:L.location||void 0,notes:L.notes||void 0});p(t),q({day:"Lundi",startHour:"",endHour:"",location:"",notes:""})}catch(a){}},re=async t=>{var a;if(null===t||void 0===t||null===(a=t.preventDefault)||void 0===a||a.call(t),!function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return!e||/^https?:\/\/.+/i.test(e.trim())||/^data:image\/(png|jpeg|webp);base64,/.test(e.trim())}(I))return E("URL d'image invalide");try{const{data:t}=await l.A.patch("/clubs/".concat(e),{bgImageUrl:I.trim()});p(t),E("")}catch(n){var i,r;E((null===(i=n.response)||void 0===i||null===(r=i.data)||void 0===r?void 0:r.error)||"Erreur mise \xe0 jour image")}};var ne,le;return e?(0,o.jsxs)("div",{children:[(0,o.jsx)("div",{style:{marginBottom:10},children:(0,o.jsx)(n.N_,{to:"/clubs",className:"week-btn",children:"\u27f5 Retour aux clubs"})}),R&&(0,o.jsx)("div",{style:{color:"red",marginBottom:12},children:R}),v&&(0,o.jsxs)("div",{className:"club-hero",style:null!==v&&void 0!==v&&v.bgImageUrl?{backgroundImage:'linear-gradient(0deg, rgba(0,0,0,0.35), rgba(0,0,0,0.35)), url("'.concat(v.bgImageUrl,'")')}:void 0,children:[(0,o.jsx)("div",{className:"club-hero__title",children:(null===v||void 0===v?void 0:v.clubName)||(null===v||void 0===v?void 0:v.name)||"Club"}),(0,o.jsxs)("div",{className:"club-hero__meta",children:[$&&(0,o.jsx)("span",{className:"pill pill--subject",children:"Soutien & Aide"}),(null===v||void 0===v?void 0:v.day)&&(0,o.jsxs)("span",{className:"pill",children:[v.day," ",v.startHour," \u2192 ",v.endHour]}),(null===v||void 0===v?void 0:v.location)&&(0,o.jsxs)("span",{className:"pill",children:["@ ",v.location]})]})]}),P&&(0,o.jsxs)("form",{onSubmit:re,style:{display:"grid",gridTemplateColumns:"1fr auto auto",gap:8,marginBottom:12},children:[(0,o.jsx)("input",{placeholder:"URL d'image de fond (https://... ou data:image/...)",value:I,onChange:e=>{F(e.target.value),B(!0)}}),(0,o.jsx)("button",{className:"week-btn",type:"submit",children:"Enregistrer"}),(0,o.jsx)("button",{type:"button",className:"week-btn",onClick:()=>{F(""),re()},children:"Supprimer"})]}),P&&(0,o.jsxs)("div",{style:{marginBottom:12},children:[(0,o.jsx)(s.A,{onUploaded:e=>{"approved"===e.status&&e.url&&(F(d(e.url)),B(!0))}}),(0,o.jsx)("small",{style:{color:"var(--muted)"},children:"Ou t\xe9l\xe9verse une image et enregistre pour l\u2019appliquer."})]}),I&&(0,o.jsxs)("div",{style:{marginBottom:10},children:[(0,o.jsx)("small",{children:"Aper\xe7u:"}),(0,o.jsx)("img",{src:d(I),alt:"",style:{width:"100%",maxHeight:180,objectFit:"cover",borderRadius:8,border:"1px solid var(--line)"},onError:()=>B(!1)}),!T&&(0,o.jsx)("div",{style:{color:"crimson"},children:"Impossible de charger l\u2019image."})]}),v&&(0,o.jsxs)("div",{style:{border:"1px solid var(--line)",borderRadius:8,padding:12,background:"var(--panel)",marginBottom:16},children:[(0,o.jsxs)("div",{style:{marginBottom:8},children:[(0,o.jsx)("span",{style:{display:"inline-flex",alignItems:"center",gap:8,padding:"6px 10px",borderRadius:8,color:"#fff",background:v.color||"#2563eb",boxShadow:"var(--shadow)"},title:v.clubName,children:(0,o.jsx)("strong",{children:v.clubName})}),a&&(0,o.jsx)("button",{className:"week-btn",style:{marginLeft:8},onClick:async()=>{try{const t="/clubs/".concat(e,"/").concat(g?"unfollow":"follow"),{data:a}=await l.A.post(t);b(!!a.following)}catch(t){}},children:g?"Ne plus suivre":"Suivre"})]}),(0,o.jsxs)("div",{children:[v.day," (",v.startHour," \u2192 ",v.endHour,") ",v.location?"@ ".concat(v.location):""]}),v.description&&(0,o.jsx)("div",{style:{marginTop:6},children:(0,o.jsx)("em",{children:v.description})})]}),P&&(0,o.jsxs)("form",{onSubmit:G,style:{display:"grid",gridTemplateColumns:"repeat(6, minmax(160px,1fr))",gap:8,marginBottom:16},children:[(0,o.jsxs)("label",{children:["Titre",(0,o.jsx)("input",{value:N.title,onChange:e=>D(t=>(0,i.A)((0,i.A)({},t),{},{title:e.target.value})),required:!0})]}),(0,o.jsxs)("label",{children:["Date",(0,o.jsx)("input",{type:"date",value:N.date,onChange:e=>D(t=>(0,i.A)((0,i.A)({},t),{},{date:e.target.value})),required:!0})]}),(0,o.jsxs)("label",{children:["D\xe9but",(0,o.jsx)("input",{type:"time",value:N.startHour,onChange:e=>D(t=>(0,i.A)((0,i.A)({},t),{},{startHour:e.target.value}))})]}),(0,o.jsxs)("label",{children:["Fin",(0,o.jsx)("input",{type:"time",value:N.endHour,onChange:e=>D(t=>(0,i.A)((0,i.A)({},t),{},{endHour:e.target.value}))})]}),(0,o.jsxs)("label",{children:["Lieu",(0,o.jsx)("input",{value:N.location,onChange:e=>D(t=>(0,i.A)((0,i.A)({},t),{},{location:e.target.value}))})]}),(0,o.jsxs)("label",{children:["Couleur",(0,o.jsx)("input",{type:"color",value:N.color,onChange:e=>D(t=>(0,i.A)((0,i.A)({},t),{},{color:e.target.value}))})]}),(0,o.jsxs)("label",{style:{gridColumn:"1/-1"},children:["Description",(0,o.jsx)("input",{value:N.description,onChange:e=>D(t=>(0,i.A)((0,i.A)({},t),{},{description:e.target.value}))})]}),(0,o.jsxs)("div",{style:{gridColumn:"1/-1"},children:[(0,o.jsx)("label",{children:"Image (optionnelle, approuv\xe9e seulement; sinon couleur utilis\xe9e)"}),(0,o.jsx)(s.A,{onUploaded:e=>{if("approved"===e.status&&e.url){const t=d(e.url);D(e=>(0,i.A)((0,i.A)({},e),{},{imageUrl:t}))}}}),N.imageUrl&&(0,o.jsxs)("div",{style:{marginTop:6,display:"flex",alignItems:"center",gap:8},children:[(0,o.jsx)("img",{src:N.imageUrl,alt:"aper\xe7u",style:{height:40,borderRadius:6,border:"1px solid var(--line)"}}),(0,o.jsx)("button",{type:"button",className:"week-btn",onClick:()=>D(e=>(0,i.A)((0,i.A)({},e),{},{imageUrl:""})),children:"Retirer l\u2019image"})]})]}),(0,o.jsxs)("fieldset",{style:{gridColumn:"1/-1",border:"1px solid var(--line)",padding:8,borderRadius:8},children:[(0,o.jsx)("legend",{style:{padding:"0 6px"},children:"R\xe9currence (optionnel)"}),(0,o.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit,minmax(160px,1fr))",gap:8},children:[(0,o.jsxs)("label",{children:["Fr\xe9quence",(0,o.jsxs)("select",{value:f.frequency,onChange:e=>H(t=>(0,i.A)((0,i.A)({},t),{},{frequency:e.target.value})),children:[(0,o.jsx)("option",{value:"",children:"\u2014 Aucune \u2014"}),(0,o.jsx)("option",{value:"DAILY",children:"Quotidien"}),(0,o.jsx)("option",{value:"WEEKLY",children:"Hebdomadaire"}),(0,o.jsx)("option",{value:"MONTHLY",children:"Mensuel"})]})]}),f.frequency&&(0,o.jsxs)("label",{children:["Intervalle",(0,o.jsx)("input",{type:"number",min:1,value:f.interval,onChange:e=>H(t=>(0,i.A)((0,i.A)({},t),{},{interval:e.target.value}))})]}),f.frequency&&(0,o.jsxs)("label",{children:["Jusqu'\xe0",(0,o.jsx)("input",{type:"date",value:f.until,onChange:e=>H(t=>(0,i.A)((0,i.A)({},t),{},{until:e.target.value}))})]}),"WEEKLY"===f.frequency&&(0,o.jsx)("div",{style:{display:"flex",flexWrap:"wrap",gap:6},children:["MO","TU","WE","TH","FR","SA","SU"].map(e=>{const t=f.byDay.includes(e);return(0,o.jsx)("button",{type:"button",onClick:()=>H(a=>(0,i.A)((0,i.A)({},a),{},{byDay:t?a.byDay.filter(t=>t!==e):[...a.byDay,e]})),className:"week-btn",style:{background:t?"var(--accent-soft)":"var(--panel)"},children:{MO:"Lun",TU:"Mar",WE:"Mer",TH:"Jeu",FR:"Ven",SA:"Sam",SU:"Dim"}[e]},e)})})]})]}),(0,o.jsx)("div",{style:{gridColumn:"1/-1"},children:(0,o.jsx)("button",{type:"submit",className:"week-btn",children:"Cr\xe9er un \xe9v\xe9nement pour ce club"})})]}),P&&$&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("h3",{children:"Ajouter une disponibilit\xe9"}),(0,o.jsxs)("form",{onSubmit:X,style:{display:"grid",gridTemplateColumns:"repeat(6, minmax(140px,1fr))",gap:8,marginBottom:16},children:[(0,o.jsxs)("label",{children:["Date",(0,o.jsx)("input",{type:"date",value:_.date,onChange:e=>U(t=>(0,i.A)((0,i.A)({},t),{},{date:e.target.value})),required:!0})]}),(0,o.jsxs)("label",{children:["D\xe9but",(0,o.jsx)("input",{type:"time",value:_.startHour,onChange:e=>U(t=>(0,i.A)((0,i.A)({},t),{},{startHour:e.target.value})),required:!0})]}),(0,o.jsxs)("label",{children:["Fin",(0,o.jsx)("input",{type:"time",value:_.endHour,onChange:e=>U(t=>(0,i.A)((0,i.A)({},t),{},{endHour:e.target.value})),required:!0})]}),(0,o.jsxs)("label",{children:["Mati\xe8re",(0,o.jsx)("input",{value:_.subject,onChange:e=>U(t=>(0,i.A)((0,i.A)({},t),{},{subject:e.target.value})),required:!0})]}),(0,o.jsxs)("label",{children:["Prof/Intervenant",(0,o.jsx)("input",{value:_.teacher,onChange:e=>U(t=>(0,i.A)((0,i.A)({},t),{},{teacher:e.target.value})),required:!0})]}),(0,o.jsxs)("label",{children:["Capacit\xe9",(0,o.jsx)("input",{type:"number",min:"1",value:_.capacity,onChange:e=>U(t=>(0,i.A)((0,i.A)({},t),{},{capacity:e.target.value}))})]}),(0,o.jsxs)("label",{style:{gridColumn:"1/-1"},children:["Notes",(0,o.jsx)("input",{value:_.notes,onChange:e=>U(t=>(0,i.A)((0,i.A)({},t),{},{notes:e.target.value}))})]}),(0,o.jsx)("div",{style:{gridColumn:"1/-1"},children:(0,o.jsx)("button",{className:"week-btn",type:"submit",children:"Ajouter"})})]})]}),(0,o.jsx)("h3",{children:"Disponibilit\xe9s"}),$&&(0,o.jsxs)("div",{className:"aide-card-wrap",children:[!((null===v||void 0===v?void 0:v.availabilities)||[]).length&&(0,o.jsx)("div",{style:{color:"var(--muted)"},children:"Aucune disponibilit\xe9."}),((null===v||void 0===v?void 0:v.availabilities)||[]).slice().sort((e,t)=>new Date(e.date)-new Date(t.date)||String(e.startHour).localeCompare(String(t.startHour))).map(t=>{const a=P?(w||[]).filter(e=>e.availabilityId===t._id&&"approved"===e.status).length:null;return(0,o.jsxs)("div",{className:"aide-card",children:[(0,o.jsx)("div",{className:"aide-card__date",children:new Date(t.date).toLocaleDateString("fr-FR")}),(0,o.jsxs)("div",{className:"aide-card__time",children:[t.startHour," \u2013 ",t.endHour]}),(0,o.jsx)("div",{className:"aide-card__subject",children:(0,o.jsx)("span",{className:"pill pill--subject",children:t.subject})}),(0,o.jsxs)("div",{className:"aide-card__teacher",children:["Avec ",t.teacher]}),(0,o.jsx)("div",{className:"aide-card__notes",children:t.notes}),"number"===typeof a&&(0,o.jsx)("div",{className:"aide-card__cap",children:(0,o.jsxs)("span",{className:"pill pill--info",children:[a,"/",t.capacity," inscrits"]})}),P?(0,o.jsx)("button",{className:"week-btn",onClick:()=>(async t=>{if(P)try{await l.A.delete("/clubs/".concat(e,"/availability/").concat(t));const{data:a}=await l.A.get("/clubs/".concat(e));if(p(a),P){const{data:t}=await l.A.get("/clubs/".concat(e,"/requests"));C(Array.isArray(t)?t:[])}}catch(a){}})(t._id),children:"Supprimer"}):(0,o.jsx)("button",{className:"week-btn",onClick:()=>(async t=>{try{const a=window.prompt("Message (facultatif):","")||"";await l.A.post("/clubs/".concat(e,"/requests"),{availabilityId:t,note:a}),alert("Demande envoy\xe9e")}catch(r){var a,i;alert((null===(a=r.response)||void 0===a||null===(i=a.data)||void 0===i?void 0:i.error)||"Erreur envoi demande")}})(t._id),children:"Demander"})]},t._id)})]}),P&&$&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("h3",{children:"Demandes d\u2019\xe9l\xe8ves"}),0===w.length&&(0,o.jsx)("div",{style:{color:"var(--muted)"},children:"Aucune demande."}),(0,o.jsx)("ul",{style:{paddingLeft:16},children:w.map(e=>{var t;return(0,o.jsxs)("li",{style:{marginBottom:8},children:[(0,o.jsx)("strong",{children:(null===(t=e.student)||void 0===t?void 0:t.username)||"\xe9l\xe8ve"})," \u2014 ",e.availability?"".concat(new Date(e.availability.date).toLocaleDateString("fr-FR")," ").concat(e.availability.startHour,"\u2013").concat(e.availability.endHour," (avec ").concat(e.availability.teacher,")"):"(cr\xe9neau indisponible)",e.note?" \u2014 \u201c".concat(e.note,"\u201d"):"",(0,o.jsxs)("span",{className:"status-badge status-badge--".concat(e.status),children:["[",e.status,"]"]}),"pending"===e.status&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("button",{className:"week-btn",style:{marginLeft:8},onClick:()=>ae(e._id,"approve"),children:"Approuver"}),(0,o.jsx)("button",{className:"week-btn",style:{marginLeft:6},onClick:()=>ae(e._id,"deny"),children:"Refuser"})]})]},e._id)})})]}),(0,o.jsx)("h3",{children:"\xc9v\xe9nements du club"}),0===m.length&&(0,o.jsx)("div",{style:{color:"var(--muted)"},children:"Aucun \xe9v\xe9nement."}),(0,o.jsx)("ul",{children:m.map(e=>{var t;return(0,o.jsxs)("li",{style:{marginBottom:10},children:[(0,o.jsx)("span",{style:{display:"inline-block",width:10,height:10,borderRadius:10,background:e.color||"#60A5FA",marginRight:8}}),(0,o.jsx)("strong",{children:e.title})," \u2014 ",new Date(e.date).toLocaleDateString("fr-FR"),e.startHour&&" ".concat(e.startHour)," ",e.endHour&&"\u2013".concat(e.endHour),e.location&&" @ ".concat(e.location),(null===(t=e.recurrence)||void 0===t?void 0:t.frequency)&&(0,o.jsx)("span",{style:{marginLeft:6,color:"var(--muted)",fontSize:12},children:"(r\xe9current)"}),P&&(0,o.jsx)("button",{className:"week-btn",style:{marginLeft:8},onClick:()=>(e=>{O(e._id),J({title:e.title||"",date:(e.date?new Date(e.date):new Date).toISOString().slice(0,10),startHour:e.startHour||"",endHour:e.endHour||"",location:e.location||"",description:e.description||"",imageUrl:e.imageUrl||"",color:e.color||"#60A5FA"})})(e),children:"Modifier"}),a&&(0,o.jsx)("button",{className:"week-btn",style:{marginLeft:8},onClick:async()=>{try{const t=x.includes(e._id),a="/events/".concat(e._id,"/").concat(t?"unsubscribe":"subscribe"),{data:i}=await l.A.post(a);i.subscribed?y(t=>t.concat(e._id)):y(t=>t.filter(t=>t!==e._id))}catch(t){}},children:x.includes(e._id)?"Se d\xe9sabonner":"S\u2019abonner"}),a&&(0,o.jsx)("button",{className:"week-btn",style:{marginLeft:6},onClick:async()=>{try{const t=j.includes(e._id),a="/events/".concat(e._id,"/").concat(t?"unpin":"pin"),{data:i}=await l.A.post(a);i.pinned?A(t=>t.concat(e._id)):A(t=>t.filter(t=>t!==e._id))}catch(t){}},children:j.includes(e._id)?"Retirer EDT":"+ EDT"}),M===e._id&&(0,o.jsx)("div",{style:{marginTop:8,border:"1px solid var(--line)",borderRadius:8,padding:8,background:"var(--panel)"},children:(0,o.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"repeat(6, minmax(140px,1fr))",gap:8},children:[(0,o.jsxs)("label",{children:["Titre",(0,o.jsx)("input",{value:W.title,onChange:e=>J(t=>(0,i.A)((0,i.A)({},t),{},{title:e.target.value}))})]}),(0,o.jsxs)("label",{children:["Date",(0,o.jsx)("input",{type:"date",value:W.date,onChange:e=>J(t=>(0,i.A)((0,i.A)({},t),{},{date:e.target.value}))})]}),(0,o.jsxs)("label",{children:["D\xe9but",(0,o.jsx)("input",{type:"time",value:W.startHour,onChange:e=>J(t=>(0,i.A)((0,i.A)({},t),{},{startHour:e.target.value}))})]}),(0,o.jsxs)("label",{children:["Fin",(0,o.jsx)("input",{type:"time",value:W.endHour,onChange:e=>J(t=>(0,i.A)((0,i.A)({},t),{},{endHour:e.target.value}))})]}),(0,o.jsxs)("label",{children:["Lieu",(0,o.jsx)("input",{value:W.location,onChange:e=>J(t=>(0,i.A)((0,i.A)({},t),{},{location:e.target.value}))})]}),(0,o.jsxs)("label",{style:{gridColumn:"1/-1"},children:["Description",(0,o.jsx)("input",{value:W.description,onChange:e=>J(t=>(0,i.A)((0,i.A)({},t),{},{description:e.target.value}))})]}),(0,o.jsxs)("div",{style:{gridColumn:"1/-1",display:"flex",flexDirection:"column",gap:6},children:[(0,o.jsx)("label",{children:"Image (remplace la couleur si d\xe9finie)"}),(0,o.jsx)(s.A,{onUploaded:e=>{if("approved"===e.status&&e.url){const t=d(e.url);J(e=>(0,i.A)((0,i.A)({},e),{},{imageUrl:t}))}}}),(0,o.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,o.jsx)("small",{style:{color:"var(--muted)"},children:"ou couleur"}),(0,o.jsx)("input",{type:"color",value:W.color,onChange:e=>J(t=>(0,i.A)((0,i.A)({},t),{},{color:e.target.value}))})]}),W.imageUrl&&(0,o.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,o.jsx)("img",{src:W.imageUrl,alt:"aper\xe7u",style:{height:32,borderRadius:4,border:"1px solid var(--line)"}}),(0,o.jsx)("button",{type:"button",className:"week-btn",onClick:()=>J(e=>(0,i.A)((0,i.A)({},e),{},{imageUrl:""})),children:"Retirer l\u2019image"})]})]}),(0,o.jsxs)("div",{style:{gridColumn:"1/-1",display:"flex",gap:8},children:[(0,o.jsx)("button",{className:"week-btn",type:"button",onClick:te,children:"Enregistrer"}),(0,o.jsx)("button",{className:"week-btn",type:"button",onClick:ee,children:"Annuler"})]})]})})]},e._id)})}),(0,o.jsx)("h3",{children:"Horaires du club"}),0===((null===v||void 0===v||null===(ne=v.weeklySlots)||void 0===ne?void 0:ne.length)||0)&&(0,o.jsxs)("div",{style:{color:"var(--muted)"},children:["Horaire principal: ",null===v||void 0===v?void 0:v.day," (",null===v||void 0===v?void 0:v.startHour," \u2192 ",null===v||void 0===v?void 0:v.endHour,") ",null!==v&&void 0!==v&&v.location?"@ ".concat(v.location):""]}),((null===v||void 0===v||null===(le=v.weeklySlots)||void 0===le?void 0:le.length)||0)>0&&(0,o.jsxs)("div",{style:{border:"1px solid var(--line)",borderRadius:8,padding:10,marginBottom:12},children:[(0,o.jsxs)("div",{style:{marginBottom:6,color:"var(--muted)"},children:["Horaire principal: ",null===v||void 0===v?void 0:v.day," (",null===v||void 0===v?void 0:v.startHour," \u2192 ",null===v||void 0===v?void 0:v.endHour,") ",null!==v&&void 0!==v&&v.location?"@ ".concat(v.location):""]}),v.weeklySlots.slice().sort((e,t)=>K[e.day]-K[t.day]||String(e.startHour).localeCompare(String(t.startHour))).map(t=>(0,o.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8,padding:"6px 0",borderBottom:"1px dashed var(--line)"},children:[(0,o.jsx)("div",{style:{minWidth:120},children:t.day}),(0,o.jsxs)("div",{style:{minWidth:120},children:[t.startHour," \u2013 ",t.endHour]}),(0,o.jsxs)("div",{style:{flex:1,color:"var(--muted)"},children:[t.location||(null===v||void 0===v?void 0:v.location)||"",t.notes?" \u2014 ".concat(t.notes):""]}),P&&(0,o.jsx)("button",{className:"week-btn",onClick:()=>(async t=>{try{await l.A.delete("/clubs/".concat(e,"/weekly-slot/").concat(t));const{data:a}=await l.A.get("/clubs/".concat(e));p(a)}catch(a){}})(t._id),children:"Supprimer"})]},t._id))]}),P&&(0,o.jsxs)("form",{onSubmit:ie,style:{display:"grid",gridTemplateColumns:"repeat(6, minmax(140px,1fr))",gap:8,marginBottom:16},children:[(0,o.jsxs)("label",{children:["Jour",(0,o.jsx)("select",{value:L.day,onChange:e=>q(t=>(0,i.A)((0,i.A)({},t),{},{day:e.target.value})),children:["Lundi","Mardi","Mercredi","Jeudi","Vendredi","Samedi","Dimanche"].map(e=>(0,o.jsx)("option",{value:e,children:e},e))})]}),(0,o.jsxs)("label",{children:["D\xe9but",(0,o.jsx)("input",{type:"time",value:L.startHour,onChange:e=>q(t=>(0,i.A)((0,i.A)({},t),{},{startHour:e.target.value})),required:!0})]}),(0,o.jsxs)("label",{children:["Fin",(0,o.jsx)("input",{type:"time",value:L.endHour,onChange:e=>q(t=>(0,i.A)((0,i.A)({},t),{},{endHour:e.target.value})),required:!0})]}),(0,o.jsxs)("label",{children:["Lieu",(0,o.jsx)("input",{value:L.location,onChange:e=>q(t=>(0,i.A)((0,i.A)({},t),{},{location:e.target.value}))})]}),(0,o.jsxs)("label",{style:{gridColumn:"1/-1"},children:["Notes",(0,o.jsx)("input",{value:L.notes,onChange:e=>q(t=>(0,i.A)((0,i.A)({},t),{},{notes:e.target.value}))})]}),(0,o.jsx)("div",{style:{gridColumn:"1/-1"},children:(0,o.jsx)("button",{className:"week-btn",type:"submit",children:"Ajouter l\u2019horaire"})})]})]}):(0,o.jsxs)("div",{children:[(0,o.jsx)("h2",{children:"Emploi du temps des clubs"}),R&&(0,o.jsx)("div",{style:{color:"red",marginBottom:"1em"},children:R}),(0,o.jsx)("div",{children:c.map(e=>{const a=e.color||"#2563eb";return(0,o.jsxs)("div",{className:"club-card",style:{border:"1px solid var(--line)",borderRadius:8,padding:10,marginBottom:10,background:"var(--panel)"},children:[(0,o.jsx)("div",{style:{marginBottom:8},children:(0,o.jsx)("span",{onClick:()=>t("/clubs/".concat(e._id)),role:"button",tabIndex:0,onKeyDown:a=>("Enter"===a.key||" "===a.key)&&t("/clubs/".concat(e._id)),style:{display:"inline-flex",alignItems:"center",gap:8,padding:"6px 10px",borderRadius:8,color:"#fff",background:a,boxShadow:"var(--shadow)",cursor:"pointer"},title:"Ouvrir la page du club",children:(0,o.jsx)("strong",{children:e.name||e.clubName})})}),(0,o.jsxs)("div",{children:[(0,o.jsx)("strong",{children:e.clubName})," \u2013 ",e.day," (",e.startHour," \u2192 ",e.endHour,") ",e.location?"@ ".concat(e.location):""]}),e.description&&(0,o.jsx)("em",{children:e.description}),z&&(0,o.jsx)("div",{style:{marginTop:8},children:(0,o.jsx)("button",{onClick:()=>(async e=>{try{await l.A.delete("/clubs/".concat(e)),await Q(),E("")}catch(t){E("Erreur suppression")}})(e._id),children:"\ud83d\uddd1\ufe0f Supprimer"})})]},e._id)})}),z&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("h3",{children:"Ajouter un club"}),(0,o.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),S.clubName&&S.startHour&&S.endHour)if(S.startHour>=S.endHour)E("L'heure de d\xe9but doit \xeatre avant l'heure de fin.");else try{await l.A.post("/clubs",S),await Q(),k({clubName:"",day:"Lundi",startHour:"",endHour:"",location:"",description:""}),E("")}catch(n){var t,a,i,r;E((null===(t=n.response)||void 0===t||null===(a=t.data)||void 0===a?void 0:a.error)||(null===(i=n.response)||void 0===i||null===(r=i.data)||void 0===r?void 0:r.message)||"Erreur ajout club")}else E("Nom, heure d\xe9but et heure fin obligatoires.")},style:{display:"grid",gap:8,maxWidth:560},children:[(0,o.jsx)("input",{name:"clubName",placeholder:"Nom du club",value:S.clubName,onChange:Z,required:!0}),(0,o.jsxs)("select",{name:"day",value:S.day,onChange:Z,children:[(0,o.jsx)("option",{children:"Lundi"}),(0,o.jsx)("option",{children:"Mardi"}),(0,o.jsx)("option",{children:"Mercredi"}),(0,o.jsx)("option",{children:"Jeudi"}),(0,o.jsx)("option",{children:"Vendredi"}),(0,o.jsx)("option",{children:"Samedi"}),(0,o.jsx)("option",{children:"Dimanche"})]}),(0,o.jsx)("input",{name:"startHour",type:"time",value:S.startHour,onChange:Z,required:!0}),(0,o.jsx)("input",{name:"endHour",type:"time",value:S.endHour,onChange:Z,required:!0}),(0,o.jsx)("input",{name:"location",placeholder:"Lieu",value:S.location,onChange:Z}),(0,o.jsx)("input",{name:"description",placeholder:"Description",value:S.description,onChange:Z}),(0,o.jsx)("button",{type:"submit",children:"Ajouter"})]})]})]})}},912:(e,t,a)=>{a.d(t,{A:()=>s});var i=a(555),r=a(43),n=a(674),l=a(579);function s(e){let{onUploaded:t,showPreview:a=!0,previewSize:s=64}=e;const[o,d]=(0,r.useState)(null),[c,u]=(0,r.useState)(""),[v,p]=(0,r.useState)(""),m=(0,r.useRef)(null);return(0,l.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:8},children:[(0,l.jsx)("input",{type:"file",accept:"image/png,image/jpeg,image/webp",ref:m,onChange:e=>{var t;const a=null===(t=e.target.files)||void 0===t?void 0:t[0];a&&(a.size>2097152?u("> 2MB refus\xe9"):(d(a),p(URL.createObjectURL(a)),u("")))}}),a&&v&&(0,l.jsx)("img",{src:v,alt:"pr\xe9visualisation",style:{width:s,height:s,objectFit:"cover",border:"1px solid var(--line)",borderRadius:6}}),(0,l.jsx)("button",{className:"week-btn",type:"button",onClick:async e=>{var a;if(null===e||void 0===e||null===(a=e.preventDefault)||void 0===a||a.call(e),!o)return;u("Envoi...");const r=new FormData;r.append("file",o);try{var l,s;const{data:e}=await n.A.post("/media/image",r,{headers:{"Content-Type":"multipart/form-data"}});u("approved"===e.status?"OK":"En attente mod\xe9ration"),d(null),m.current&&(m.current.value="");const a=(null===n.A||void 0===n.A||null===(l=n.A.defaults)||void 0===l||null===(s=l.baseURL)||void 0===s?void 0:s.replace(/\/$/,""))||"",o=null!==e&&void 0!==e&&e.url?e.url.startsWith("/")?a+e.url:e.url:"";p("approved"===e.status&&o?o:""),t&&t((0,i.A)((0,i.A)({},e),{},{absoluteUrl:o}))}catch(h){var c,v;const e=(null===(c=h.response)||void 0===c||null===(v=c.data)||void 0===v?void 0:v.error)||"Erreur upload";u(e)}},disabled:!o,children:"Uploader l\u2019image"}),c&&(0,l.jsx)("small",{style:{color:"var(--muted)"},children:c})]})}}}]);
//# sourceMappingURL=736.ffe4f724.chunk.js.map